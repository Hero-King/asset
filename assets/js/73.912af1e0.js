(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{483:function(t,s,a){"use strict";a.r(s);var n=a(33),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"openwrt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#openwrt"}},[t._v("#")]),t._v(" openwrt")]),t._v(" "),s("h2",{attrs:{id:"概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[t._v("#")]),t._v(" 概念")]),t._v(" "),s("p",[t._v("luci op 的页面, 如果需要使用页面管理插件, 需要安装 luci-app-*的包\nopkg op 的软件包管理程序, opkg install; list ;\nuci op 的配置文件配置器")]),t._v(" "),s("h2",{attrs:{id:"资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[t._v("#")]),t._v(" 资料")]),t._v(" "),s("p",[t._v("野火 OpenWrt 用户手册 ： https://doc.embedfire.com/openwrt/user_manal/zh/latest/index.html")]),t._v(" "),s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),s("p",[t._v("后续使用 openwrt.ai 生成")]),t._v(" "),s("p",[t._v("按照品牌搜索下载对应的 sysupdate.bin 包\npve 安装 "),s("code",[t._v("qm importdisk 100 /var/lib/vz/template/iso/xx.img local --format qcow2")]),t._v(" ; (100 是 VMid) 然后磁盘添加; 设置硬盘启动; 启动后修改密码; ip: 192.168.2.1 修改 ip "),s("code",[t._v("vi /etc/config/network")])]),t._v(" "),s("p",[t._v("ipv6 可能需要 21.02.3 版本")]),t._v(" "),s("h2",{attrs:{id:"插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#插件"}},[t._v("#")]),t._v(" 插件")]),t._v(" "),s("ul",[s("li",[t._v("首页改用 nginx")]),t._v(" "),s("li",[t._v("去掉科学上网;dns 过滤; arpbind; cifs-mount; cpulimit; filebrowser; eqos; easymesh; ;")]),t._v(" "),s("li",[t._v("adbyby 广告屏蔽")]),t._v(" "),s("li",[t._v("网络存储都要 aria2 nfs ftp Samba4 Transmission")]),t._v(" "),s("li",[t._v("vpn 都要 v2ray; openvpn; IPSec VPN; PPTP VPN 服务器")]),t._v(" "),s("li",[t._v("阿里云盘 FUSE")]),t._v(" "),s("li",[t._v("阿里云盘 WebDAV")]),t._v(" "),s("li",[t._v("ddns; frps; kms")]),t._v(" "),s("li",[t._v("BearDropper (公网 ssh 防御)")]),t._v(" "),s("li",[t._v("ServerChan (微信推送)")]),t._v(" "),s("li",[t._v("nlbw 宽带监控")]),t._v(" "),s("li",[t._v("accesscontrol 访问时间控制")]),t._v(" "),s("li",[t._v("abdlock ABD 广告过滤")]),t._v(" "),s("li",[t._v("amule amule 下载工具")]),t._v(" "),s("li",[t._v("dockerman docker 执行 /etc/init.d/dockerd 管理docker 设置开启启动: ln -s /etc/init.d/dockerd /etc/rc.d/S100docker")]),t._v(" "),s("li",[t._v("kodexplorer 可道云（像 windows 一样管理文件）")]),t._v(" "),s("li",[t._v("AdGuard Home 去广告插件(原理 dns 劫持)")]),t._v(" "),s("li",[t._v("openclash 代理")])]),t._v(" "),s("h3",{attrs:{id:"常用的包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用的包"}},[t._v("#")]),t._v(" 常用的包")]),t._v(" "),s("ul",[s("li",[t._v("ttyd web shell")]),t._v(" "),s("li",[t._v("v2ray-server")]),t._v(" "),s("li",[t._v("netdata (性能检测) "),s("code",[t._v("cd /usr/share/netdata/web chown -R root:root *")])]),t._v(" "),s("li",[t._v("acme 自动化 ssl 证书管理")]),t._v(" "),s("li",[t._v("aria2 下载工具")]),t._v(" "),s("li",[t._v("arpbind ip/mac 绑定")]),t._v(" "),s("li",[t._v("autoreboot 计划重启")]),t._v(" "),s("li",[t._v("ddns 各种厂商的 ddns 服务")]),t._v(" "),s("li",[t._v("frps frp 服务端 看情况安装")]),t._v(" "),s("li",[t._v("samba4")]),t._v(" "),s("li",[t._v("smartdns dns 服务器")]),t._v(" "),s("li",[t._v("vsftp")]),t._v(" "),s("li",[t._v("nginx-manager")]),t._v(" "),s("li",[t._v("diskman 磁盘管理")]),t._v(" "),s("li",[t._v("wechatpush 微信推送")]),t._v(" "),s("li",[t._v("wolplus")]),t._v(" "),s("li",[t._v("turboacc 网络加速")]),t._v(" "),s("li",[t._v("alist 多网站网盘文件列表")]),t._v(" "),s("li",[t._v("zerotier 零盾 异地组网 内网穿透 vpn")])]),t._v(" "),s("h2",{attrs:{id:"配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),s("h3",{attrs:{id:"smartdns"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#smartdns"}},[t._v("#")]),t._v(" smartdns")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("cname /blog.heroking.top/hero-king.github.io\ncname /pan.heroking.top/hero-king.github.io\ncname /nav.heroking.top/hero-king.github.io\naddress /heroking.top/192.168.2.4\n")])])]),s("h3",{attrs:{id:"passwall"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#passwall"}},[t._v("#")]),t._v(" Passwall")]),t._v(" "),s("p",[t._v("DNS 注意选择DOH;打开FakeDns")]),t._v(" "),s("blockquote",[s("p",[t._v("https://nanodesu.net/archives/36/\nhttps://www.right.com.cn/forum/thread-8325875-1-1.html")])]),t._v(" "),s("h4",{attrs:{id:"根据订阅url查询流量信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#根据订阅url查询流量信息"}},[t._v("#")]),t._v(" 根据订阅URL查询流量信息")]),t._v(" "),s("p",[t._v("取响应头中的 subscription-userinfo")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sLI")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" GET "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-w")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http_code=%{http_code}'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'User-Agent: Clash'")]),t._v(" 订阅URL\n")])])]),s("h4",{attrs:{id:"pac"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pac"}},[t._v("#")]),t._v(" PAC")]),t._v(" "),s("p",[t._v("个人socks服务器放到公网")]),t._v(" "),s("ul",[s("li",[t._v("nginx对外分享PAC文件，新建auth目录中存放需要鉴权的内容，使用 query_string进行判断是否403"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('location /auth/ {\n  root /web;\n  if ($query_string !~* "aa=bb") {  \n    return 403;\n  }\n}\n')])])])]),t._v(" "),s("li",[t._v("每日动态更新socks服务器对外暴露的端口和PAC文件中socks端口")])]),t._v(" "),s("h4",{attrs:{id:"只想特定机器走代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#只想特定机器走代理"}},[t._v("#")]),t._v(" 只想特定机器走代理?")]),t._v(" "),s("p",[t._v("可以使用 passwall 的 socks 代理服务器, 在基本设置中=>socks 设置, 直接配置一个 socks 服务器, 在 Windows/Mac 中使用即可")]),t._v(" "),s("h3",{attrs:{id:"openclash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#openclash"}},[t._v("#")]),t._v(" openclash")]),t._v(" "),s("p",[t._v("上手")]),t._v(" "),s("ol",[s("li",[t._v("配置订阅中添加订阅地址，使用在线订阅地址转换处理各种路由规则")]),t._v(" "),s("li",[t._v("由于chatgpt对香港地区不提供服务，需要走国外节点，覆写设置-规则设置-自定义规则中指定chatgpt路由")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DOMAIN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("SUFFIX"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("openai.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("新加坡\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DOMAIN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("SUFFIX"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("chatgpt.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ss"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("新加坡\n")])])]),s("h3",{attrs:{id:"uhttpd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uhttpd"}},[t._v("#")]),t._v(" uhttpd")]),t._v(" "),s("p",[t._v("配置 https 则配置 "),s("code",[t._v("/etc/config/uhttpd")]),t._v("文件(https://openwrt.org/docs/guide-user/services/webserver/uhttpd)\n或者使用 luci(页面)配置 (配置了 ssl 证书需要其他端口转发到 443 同时需要使用 https 协议访问)")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("uci show uhttpd.main\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("uhttpd.main")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("uhttpd\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("uhttpd.main.listen_http")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0:80'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("uhttpd.main.listen_https")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.0.0:443'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("uhttpd.nain.tcp_keepalive")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("uhttpd.main.rfc1918_filter")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("uhttpd.main.key")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/etc/luci-uploads/cbid.uhttpd.main.key'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("uhttpd.main.cert")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/etc/luci-uploads/cbid.uhttpd.main.cert'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("uhttpd.main.redirect_https")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者0 在内网无所谓")]),t._v("\n")])])]),s("ul",[s("li",[t._v("acme 泛域名证书申请 : https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E")]),t._v(" "),s("li",[t._v("系统-启动项-appfilter 关闭自启动")])]),t._v(" "),s("h3",{attrs:{id:"nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[t._v("#")]),t._v(" nginx")]),t._v(" "),s("h4",{attrs:{id:"查看-nginx-初始配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看-nginx-初始配置"}},[t._v("#")]),t._v(" 查看 nginx 初始配置")]),t._v(" "),s("p",[t._v("https://blog.csdn.net/m0_46645810/article/details/129034751")]),t._v(" "),s("p",[t._v("设置了 root 目录 restrict_locally 是内网主机, 也就是默认配置做了 80 => 443 然后只允许内网的一个 web 服务器, ssl 证书是 openwrt 自带的")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /etc/nginx/uci.conf\n\nroot/www"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#see uci show 'nginx._lan'")]),t._v("\n    listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl default_seruer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    listen "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("::"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":443 ssl default_seruer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    seruer_name _lan"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    include restrict_locally"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    include conf.d/*.locations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_certificate /etc/nginx/conf.d/_lan.crt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_certificate_key/etc/nginx/conf.d/_lan.key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_session_cache shared:SSL:32k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_session_timeout 64m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    access_log off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#t logd openurt;")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#see uci shou 'nginx. redirect2ssl'")]),t._v("\n    listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    listen "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("::"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":80"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    seruer_name _redirect2ssl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("302")]),t._v(" https://Shost"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\ninclude conf.d/*.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"自行设置-nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自行设置-nginx"}},[t._v("#")]),t._v(" 自行设置 nginx")]),t._v(" "),s("ol",[s("li",[t._v("取消 uci 接管 nginx [可选]"),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v(" uci "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("nginx.global.uci_enable")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false\n uci commit nginx\n")])])])]),t._v(" "),s("li",[t._v("修改/etc/nginx/nginx.conf 文件或者 uci.conf [可选]")]),t._v(" "),s("li",[t._v("在/etc/nginx/conf.d/下新建配置文件, 监听其他端口, 防火墙开放, 使用 nginx 转发内网 web 服务")])]),t._v(" "),s("h3",{attrs:{id:"ssl-acme"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ssl-acme"}},[t._v("#")]),t._v(" ssl-acme")]),t._v(" "),s("p",[t._v("acme 使用 : https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E")]),t._v(" "),s("p",[t._v("页面配置: 常规设置域名先写主域名,其他域名,后写泛解析域名(*.域名) 验证方式"),s("code",[t._v("dns")]),t._v(";DnsAPI"),s("code",[t._v("dns_ali")]),t._v("; API 凭证列表: "),s("code",[t._v('Ali_Key="<key>" Ali_Secret="<secret>"')]),t._v("\n软件库搜索 dnsapi 安装\n执行 acme: "),s("code",[t._v("service acme start")]),t._v(", acme 安装在 /usr/lib/acme/client/acme.sh ,\nssl 证书目录 "),s("code",[t._v("/etc/acme/域名/域名.key和fullchain.cer")]),t._v("， 在 nginx 中配置即可")]),t._v(" "),s("h3",{attrs:{id:"v2ray"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#v2ray"}},[t._v("#")]),t._v(" v2ray")]),t._v(" "),s("p",[t._v("在 ui 中配置好，勾选允许访问内网")]),t._v(" "),s("h4",{attrs:{id:"vmess协议-配合nginx一起使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vmess协议-配合nginx一起使用"}},[t._v("#")]),t._v(" Vmess协议, 配合NGINX一起使用")]),t._v(" "),s("img",{attrs:{src:t.$withBase("/img/proxy/openwrt_v2ray_server_config.png")}}),t._v(" "),s("h3",{attrs:{id:"minidlna"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#minidlna"}},[t._v("#")]),t._v(" minidlna")]),t._v(" "),s("p",[t._v("家庭流媒体， 只需要调整下媒体目录，启用即可 后台监控可以访问网关:8200")]),t._v(" "),s("h3",{attrs:{id:"beardropper"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#beardropper"}},[t._v("#")]),t._v(" BearDropper")]),t._v(" "),s("p",[t._v("安装 luci-app-BearDropper")]),t._v(" "),s("h3",{attrs:{id:"alist"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#alist"}},[t._v("#")]),t._v(" alist")]),t._v(" "),s("p",[t._v("配置好端口, 如果需要外网访问需要防火墙放行, 启用 ssl, 数据目录不调整, 缓存目录默认"),s("code",[t._v("/tmp/alist")]),t._v(", 如果需要离线下载大文件, 调整此目录到新的磁盘分区中")]),t._v(" "),s("h3",{attrs:{id:"netdata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#netdata"}},[t._v("#")]),t._v(" netdata")]),t._v(" "),s("p",[t._v("默认不支持 https")]),t._v(" "),s("p",[t._v("修改"),s("code",[t._v("/usr/lib/lua/luci/view/netdata.htm")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("includes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'heroking.top'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'netdata'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("':8000/netdata/'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'netdata'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("':19999'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("使用 nginx 代理网页")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  listen "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("::"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":8000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name op.heroking.top"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass https://192.168.2.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  location ^~ /netdata/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     proxy_pass http://127.0.0.1:19999/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"上网"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上网"}},[t._v("#")]),t._v(" 上网")]),t._v(" "),s("h4",{attrs:{id:"单臂路由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单臂路由"}},[t._v("#")]),t._v(" 单臂路由")]),t._v(" "),s("p",[t._v("https://www.right.com.cn/forum/thread-5768047-1-1.html\nhttps://www.right.com.cn/FORUM/thread-6196997-1-1.html")]),t._v(" "),s("p",[t._v("光猫不设置 vlan 也可以")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("config interface "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'loopback'")]),t._v("\n        option device "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lo'")]),t._v("\n        option proto "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'static'")]),t._v("\n        option ipaddr "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),t._v("\n        option netmask "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'255.0.0.0'")]),t._v("\n\nconfig globals "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'globals'")]),t._v("\n        option ula_prefix "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fdf6:076a:018b::/48'")]),t._v("\n        option packet_steering "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("\n\nconfig device\n        option name "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'br-lan'")]),t._v("\n        option "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("type")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bridge'")]),t._v("\n        list ports "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eth0'")]),t._v("\n        option promisc "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("\n\nconfig interface "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lan'")]),t._v("\n        option device "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eth0'")]),t._v("\n        option proto "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'static'")]),t._v("\n        option ipaddr "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.2.1'")]),t._v("\n        option netmask "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'255.255.255.0'")]),t._v("\n        option ip6assign "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'60'")]),t._v("\n\nconfig interface "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wan'")]),t._v("\n        option proto "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pppoe'")]),t._v("\n        option username "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx'")]),t._v("\n        option password "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx'")]),t._v("\n        option device "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eth0'")]),t._v("\n        option ipv6 "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'auto'")]),t._v("\n\n")])])]),s("h4",{attrs:{id:"旁路由设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#旁路由设置"}},[t._v("#")]),t._v(" 旁路由设置")]),t._v(" "),s("ol",[s("li",[t._v("使用设置向导, 初始化成旁路有模式")]),t._v(" "),s("li",[t._v("设置DHCP服务器，将设备Mac地址与IP绑定")]),t._v(" "),s("li",[t._v("lan接口中设置DHCP分配的IP范围为100~140; 设置强制, 动态DHCP用来给绑定好ip的设备下发网关和DNS;")]),t._v(" "),s("li",[t._v("防火墙设置Lan口动态伪装(将经过网关的报文源ip地址修改为网关ip, 使得相应报文经主路由回复给网关而不是其他内网ip) 或者使用自定义规则"),s("code",[t._v("iptables -t nat -I POSTROUTING -o eth0 -j MASQUERADE")]),t._v(" 即可")]),t._v(" "),s("li",[t._v("暴露在公网中的旁路有还需要设置下述内容")]),t._v(" "),s("li",[t._v("防火墙自定义规则(允许内网设备访问op, 放行常用服务端口)")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 允许内网 IP 访问（192.168.0.0/16 网段）\niptables -A INPUT -s 192.168.0.0/16 -j ACCEPT\n\n# 允许内网 IP 访问（10.0.0.0/8 网段）\niptables -A INPUT -s 10.0.0.0/8 -j ACCEPT\n\n# 允许内网 IP 访问（172.16.0.0/12 网段）\niptables -A INPUT -s 172.16.0.0/12 -j ACCEPT\n# 范围端口使用:相连接\niptables  -A  INPUT -p tcp  -m  multiport --dports  80,443,8000,9000:10000  -j  ACCEPT\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[t._v("禁用外网访问: 防火墙-区域-lan->wan入站数据设置为拒绝")])])])}),[],!1,null,null,null);s.default=e.exports}}]);