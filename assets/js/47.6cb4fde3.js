(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{458:function(t,n,s){"use strict";s.r(n);var a=s(33),p=Object(a.a)({},(function(){var t=this,n=t._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"express源码学习"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#express源码学习"}},[t._v("#")]),t._v(" Express源码学习")]),t._v(" "),n("h2",{attrs:{id:"常规使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常规使用"}},[t._v("#")]),t._v(" 常规使用")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" express "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"express"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/info'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"req time: "')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"secode layer"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"third layer"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/info"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/info2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"req time: "')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"secode layer"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"third layer"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/info"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("Example app listening on port 3000")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h2",{attrs:{id:"模块类关系图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模块类关系图"}},[t._v("#")]),t._v(" 模块类关系图")]),t._v(" "),n("blockquote",[n("p",[t._v("使用plantuml解析器解析")])]),t._v(" "),n("div",{staticClass:"language-plantuml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-plantuml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("@startuml")]),t._v(" ClassRelationship\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v(" methods "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    post"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    put"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    delete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    patch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    head"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    connect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("...o")]),t._v("ther http methods"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' 1. 引入 Node.js 原生模块（父类）")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" EventEmitter "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' Node.js EventEmitter 核心方法（精简关键）")]),t._v("\n    + on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" listener"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" this\n    + emit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" any"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" boolean\n    + once"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" listener"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" this\n    + off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" listener"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" this\n    # _events"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object  ' 私有属性：存储事件与监听器映射\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' 基础类型定义")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" MiddlewareFunction "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    + "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NextFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" NextFunction "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    + "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err?"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' Express 核心模块")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" express "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" Express "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        - application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Application\n        - request "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Request\n        - response "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response\n        + default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Application\n        + json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void\n        + raw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void\n        + Router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Router # 创建一个新的路由对象\n        + static"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void\n        + text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void\n        + urlencoded"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' Application 核心类")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" Application extends EventEmitter "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    + request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Request\n    + response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response\n    + cache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object               # 缓存\n    + engines"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object             # 模板引擎\n    + settings"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object           # 应用配置\n    + router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Router             # 路由分发器\n    + locals"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object              # 模板变量"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("在通过 res.render 渲染的模板中可用\n    + mountpath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String           # 当前应用被当做子应用挂载的一个或多个路径\n\n    + init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void                # 初始化 server\n    + defaultConfiguration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void  # 默认配置"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("监听mount事件\n    + handle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NextFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void  # 处理请求\n    + use"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" middleware"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MiddlewareFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Application    # 使用中间件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("代理的Router.use\n    + use"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("middleware"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MiddlewareFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Application\n    + use"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("middleware"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MiddlewareFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Application\n    + route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Router   # 为path创建一个路由"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("代理Router.route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    + param"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ParamHandlerFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Application  # 为参数设置处理函数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("代理Router.param"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    + set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("setting"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value?"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" any"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Application   # 设置/获取this.settings对象\n    + path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String    # 获取当前应用挂载完整路径\n    + get/post/put/methods/all"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("handlers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MiddlewareFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Application # 路由处理"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 代理Route.methods"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    + listen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Number"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hostname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" backlog"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Number"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Server\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' Router 路由系统")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" Router "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    - stack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("             # 路由层栈\n    - methods"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object            # 注册路由的 HTTP 方法\n    - params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object             # 参数解析器\n    - caseSensitive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Boolean     # 路径大小写敏感\n    - mergeParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Boolean       # 合并参数\n\n    + route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Route    # 创建一个Route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 和 layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" route.dispatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    + get/post/put/methods/all"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("handlers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MiddlewareFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Router # 路由处理"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 代理Route.methods"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    + use"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" middleware"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MiddlewareFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Router\n    + handle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Function "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void  # 处理请求\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' Route 路由匹配层")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" Route "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    - path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String               # 路由路径\n    - stack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("             # 处理函数栈\n    - methods"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object            # 支持的 HTTP 方法\n    - sensitive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Boolean         # 大小写敏感\n    - strict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Boolean            # 严格路径匹配\n\n    + get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MiddlewareFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Route\n    + post"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MiddlewareFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Route\n    + all"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MiddlewareFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Route\n    + dispatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NextFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void # 处理请求\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' Layer 路由处理单元")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" Layer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    - path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String               # 匹配路径\n    - handle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MiddlewareFunction # 处理函数\n    - method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String             # 匹配的 HTTP 方法\n    - name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String               # 层名称\n    - params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object             # 参数缓存\n\n    + handle_request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NextFunction"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void\n    + match"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Boolean\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' 请求对象扩展")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" Request extends IncomingMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    - originalUrl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String        # 原始 URL\n    - baseUrl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String            # 挂载路径\n    - method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String             # 请求方法\n    - url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String                # 当前 URL\n    - path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String                # 当前\n    - protocol"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String                # 当前\n    - host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String                # 当前\n    - ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String                # 当前\n    - headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object            # 请求头\n    - query"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object              # 查询参数\n    - params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object             # 路由参数\n    - body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object               # 请求体\n\n    + get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("headerName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String\n    + header"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("headerName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String\n    + "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Boolean\n    + accepts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' 响应对象扩展")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" Response extends ServerResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    - statusCode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Number         # 状态码\n    - headersSent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Boolean       # 响应是否已发送\n    - _headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object           # 响应头\n\n    + send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Any"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response\n    + status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Number"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response\n    + json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response\n    + redirect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response\n    + set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("header"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Response\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' 服务器封装")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" Server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    - httpServer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http.Server    # Node.js 原生服务器\n    - _events"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" EventEmitter      # 事件发射器\n\n    + listen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Number"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hostname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" backlog"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Number"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Server\n    + close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" void\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' 关联关系")]),t._v("\nExpress "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Application "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" creates\nApplication "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Router "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" uses\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Route "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" creates\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Layer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" contains\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Layer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" contains\nLayer "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" MiddlewareFunction "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" executes\nApplication "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" creates\nRequest "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Response "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" associated\nResponse "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" NextFunction "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" uses\nApplication "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" Application "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" uses\n")])])]),n("h2",{attrs:{id:"请求处理时序图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#请求处理时序图"}},[t._v("#")]),t._v(" 请求处理时序图")]),t._v(" "),n("p",[t._v("应用启动后创建好Router的layer 和Route的layer stack, 请求处理时串行Router的layer stack中所有的Route的layer stack")]),t._v(" "),n("div",{staticClass:"language-plantuml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-plantuml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("@startuml")]),t._v(" ExpressSimplifiedSequence\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("actor")]),t._v(" Developer\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("participant")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" Application\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("participant")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app.router"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" Router\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("participant")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"route"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" Route\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("participant")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"layer"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" Layer\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' 应用初始化")]),t._v("\nDeveloper "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" const app = express"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nApplication "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app.init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \\n app.defaultConfiguration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' 注册/info路由")]),t._v("\nDeveloper "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app.get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/info'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nApplication "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" router.route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/info'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 初始化"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("单例模式"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" new Route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/info'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" new Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/info'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("router.dispatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Layer关联Route\\nrouter.stack.push"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 返回Route\nApplication "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" route.get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" new Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" new Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" new Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" this.stack.push"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" return\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' 注册/info2路由")]),t._v("\nDeveloper "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app.get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/info2'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nApplication "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" router.route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/info2'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" new Route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/info2'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" new Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/info2'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("router.dispatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Layer关联Route\\nrouter.stack.push"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 返回Route\nApplication "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" route.get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" new Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" new Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" new Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" this.stack.push"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" return\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' 启动服务器")]),t._v("\nDeveloper "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app.listen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("3000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("' 创建请求")]),t._v("\nDeveloper "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" req.get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/info'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nApplication "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" this.handle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("note")]),t._v(" left of Application\n这里的req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res为原始的请求对象和响应对象\n  - req.res = res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" res.req = req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" 保存关联\n  - Object.setPrototypeOf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app.request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  - Object.setPrototypeOf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app.response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  - 原型方式拓展req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end note")]),t._v("\nApplication "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" router.handle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" finalhandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 启动next方法 \\n 遍历stack查找匹配的layer和Route \\nlayer.match"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'/info'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nLayer "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 返回是否match\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" route._handlesMethod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'GET'"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\\n判断Route的方法是否匹配\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 返回是否match\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" layer.handleRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nLayer "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Route"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" route.dispatch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 启动next方法 \\n 遍历stack根据method查找匹配的layer \\nlayer.handleRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\\n执行传入的h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("h1中继续调用next\n\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" layer.handleRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\\n执行传入的h2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("h2中继续调用next\nRoute "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" layer.handleRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\\n执行传入的h3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("h3中继续调用next\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("note")]),t._v(" left of Route\n一直在压栈next方法"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("最后在慢慢弹栈\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end note")]),t._v("\n\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Router.next\\n查找匹配stack中其他的layer\\n重复上述步骤\nRouter "),n("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("->")]),t._v(" Developer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 响应内容\n\n"),n("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("@enduml")])])])])])}),[],!1,null,null,null);n.default=p.exports}}]);