(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{494:function(t,s,e){"use strict";e.r(s);var r=e(33),n=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"代理和内网穿透"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代理和内网穿透"}},[t._v("#")]),t._v(" 代理和内网穿透")]),t._v(" "),s("h2",{attrs:{id:"代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代理"}},[t._v("#")]),t._v(" 代理")]),t._v(" "),s("p",[t._v("主要有以下几种")]),t._v(" "),s("ul",[s("li",[t._v("正向代理: 代理客户端去请求服务器")]),t._v(" "),s("li",[t._v("反向代理: 代理服务端, 用户请求的是代理服务器, 代理服务器请求真实目的主机")])]),t._v(" "),s("p",[t._v("按照代理方式, 目前主要有 http 代理, socks 代理, 对于目前主流的 Https 协议, http 代理无能为力")]),t._v(" "),s("h2",{attrs:{id:"代理软件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代理软件"}},[t._v("#")]),t._v(" 代理软件")]),t._v(" "),s("ul",[s("li",[t._v("gost")]),t._v(" "),s("li",[t._v("v2ray")])]),t._v(" "),s("h2",{attrs:{id:"内网穿透"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内网穿透"}},[t._v("#")]),t._v(" 内网穿透")]),t._v(" "),s("p",[t._v("内网穿透又叫 nat 穿透, 本质就是解决 ipv4 供应不足问题\n正常上网路径: 内网设备 -> 内网设备 -> ... -> 运营商公网机器 nat -> 服务器 -> 运营商公网机器 nat -> 内网设备 -> ... -> 内网设备\n也就是可以从外网访问到内网机器的\n内网穿透原理就是这个\n内网服务器先和公网 IP 机器建立连接 后面由客户端请求到公网服务器 IP:PORT 公网机器把请求转发到之前建立的连接中 达到访问内网服务器的目的 但是常见的内网穿透软件(花生壳 frp) 都是针对"),s("strong",[t._v("端口进行转发")]),t._v("\n想要访问内网机器 可以使用 VPN 、 v2ray 反向代理")]),t._v(" "),s("h2",{attrs:{id:"openvpn"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#openvpn"}},[t._v("#")]),t._v(" openvpn")]),t._v(" "),s("p",[t._v("https://www.ilanni.com/?p=9837 烂泥写的挺好的")]),t._v(" "),s("h2",{attrs:{id:"pptp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pptp"}},[t._v("#")]),t._v(" PPTP")]),t._v(" "),s("p",[t._v("docker run --name pptpd --privileged --net=host -d -p 1723:1723 -v /etc/ppp/chap-secrets:/etc/ppp/chap-secrets:ro whuwxl/pptpd\n端口 1723 映射")]),t._v(" "),s("h2",{attrs:{id:"ipsec-vpn-l2tp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ipsec-vpn-l2tp"}},[t._v("#")]),t._v(" ipsec-vpn/L2tp")]),t._v(" "),s("p",[t._v("https://github.com/hwdsl2/setup-ipsec-vpn\nipsec 是对 l2tp 基础上加密处理\n路由器上的服务端是 l2tp 不带 ipsec 所以 windows 客户端设置的时候 [安全] 高级设置不选 PSC 秘钥,不选证书验证,数据加密不加密 默认 vpn 是全局流量代理\nL2TP 需开放端口：\nUDP:500\nUDP:4500\nUDP:1701")]),t._v(" "),s("h2",{attrs:{id:"使用-frp-内网穿透-esxi"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-frp-内网穿透-esxi"}},[t._v("#")]),t._v(" 使用 frp 内网穿透 esxi")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("1024 以下端口需要使用 root 用户启动 frps (注释 frps.service 中的 User=nobody)")])]),t._v(" "),s("li",[s("p",[t._v("frps 服务注册 /usr/lib/systemd/system/frps.service")])]),t._v(" "),s("li",[s("p",[t._v("frpc 映射 443 和 902 端口")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[esxi-web]\nremote_port = 9443\ntype = tcp\nlocal_ip = 192.168.123.100\nlocal_port = 443\n\n[esxi-client-windowt]\nremote_port = 902\ntype = tcp\nlocal_ip = 192.168.123.100\nlocal_port = 902\n")])])])]),t._v(" "),s("li",[s("p",[t._v("nginx 设置 301 重定向 http 转 https")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server {\n        listen       80;\n        listen       [::]:80;\n        server_name  _;\n        # rewrite ^(.*)$ https://$host$1; #将所有HTTP请求通过rewrite指令重定向到HTTPS。\n        # $host代表请求头中的host $server_name代表上面匹配的虚拟主机名称(即_)\n        return 301 https://$host$request_uri;\n    }\n")])])])]),t._v(" "),s("li",[s("p",[t._v("多域名解析到真实主机"),s("br"),t._v("\n我设置 esxi.domain 解析到主机,申请域名免费 ssl 证书")])]),t._v(" "),s("li",[s("p",[t._v("nginx 配置虚拟主机\n"),s("strong",[t._v("注意 nginx 是否支持 TLS SNI (nginx -V 查看 TLS SNI support enabled)")]),t._v("\n如果不支持 需要将 esxi 的虚拟 server 段放在最上面 当成默认的虚拟主机 应为 vmware 客户端不支持 SNI")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(' server {\n   listen       443 ssl ;\n   listen       [::]:443 ssl ;\n   server_name  域名;\n\n   ssl_certificate "/etc/pki/nginx/XXX.pem";\n   ssl_certificate_key "/etc/pki/nginx/private/XXX.key";\n   ssl_session_timeout  10m;\n   ssl_ciphers HIGH:!aNULL:!MD5;\n   ssl_prefer_server_ciphers on;\n\n    location / {\n        proxy_pass https://127.0.0.1:port;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $host;\n        # proxy_set_header X-Forward-Proto https;\n\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "upgrade";\n    }\n}\n# ...其他虚拟主机\n')])])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);