<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginx | HeroKing的个人笔记</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link href="https://cdn.bootcdn.net/ajax/libs/normalize/8.0.1/normalize.min.css" rel="stylesheet">
    <script src="https://hm.baidu.com/hm.js?3691b93bb6fcef0775ef18a936452b97" defer="true"></script>
    <meta name="description" content="学习犹如逆水行舟,不进则退">
    
    <link rel="preload" href="/assets/css/0.styles.51c3fc7f.css" as="style"><link rel="preload" href="/assets/js/app.bdff9417.js" as="script"><link rel="preload" href="/assets/js/2.877b15ed.js" as="script"><link rel="preload" href="/assets/js/1.ee4b0e89.js" as="script"><link rel="preload" href="/assets/js/28.063c60f6.js" as="script"><link rel="prefetch" href="/assets/js/10.215a54c0.js"><link rel="prefetch" href="/assets/js/100.ca9fb9ed.js"><link rel="prefetch" href="/assets/js/11.5c0721a6.js"><link rel="prefetch" href="/assets/js/12.816525e0.js"><link rel="prefetch" href="/assets/js/13.5bb3cc0b.js"><link rel="prefetch" href="/assets/js/14.967d4b24.js"><link rel="prefetch" href="/assets/js/15.cdbcacd7.js"><link rel="prefetch" href="/assets/js/16.6ed14be5.js"><link rel="prefetch" href="/assets/js/17.2b37666b.js"><link rel="prefetch" href="/assets/js/18.59de2166.js"><link rel="prefetch" href="/assets/js/19.24ad168e.js"><link rel="prefetch" href="/assets/js/20.efb5ce8c.js"><link rel="prefetch" href="/assets/js/21.bae87a1d.js"><link rel="prefetch" href="/assets/js/22.5b821325.js"><link rel="prefetch" href="/assets/js/23.afa22431.js"><link rel="prefetch" href="/assets/js/24.43f77498.js"><link rel="prefetch" href="/assets/js/25.24451938.js"><link rel="prefetch" href="/assets/js/26.3853f613.js"><link rel="prefetch" href="/assets/js/27.e75dcd38.js"><link rel="prefetch" href="/assets/js/29.7220554b.js"><link rel="prefetch" href="/assets/js/3.b50983ee.js"><link rel="prefetch" href="/assets/js/30.4ed33175.js"><link rel="prefetch" href="/assets/js/31.43c75735.js"><link rel="prefetch" href="/assets/js/32.8b320e32.js"><link rel="prefetch" href="/assets/js/33.a70cfed4.js"><link rel="prefetch" href="/assets/js/34.0d1215c8.js"><link rel="prefetch" href="/assets/js/35.b421a23a.js"><link rel="prefetch" href="/assets/js/36.001d9072.js"><link rel="prefetch" href="/assets/js/37.0778638c.js"><link rel="prefetch" href="/assets/js/38.3e0e2abd.js"><link rel="prefetch" href="/assets/js/39.2b5e1e6a.js"><link rel="prefetch" href="/assets/js/4.30e44ed7.js"><link rel="prefetch" href="/assets/js/40.ec0e2247.js"><link rel="prefetch" href="/assets/js/41.6740da22.js"><link rel="prefetch" href="/assets/js/42.9cb54dd6.js"><link rel="prefetch" href="/assets/js/43.79357489.js"><link rel="prefetch" href="/assets/js/44.baf4bea6.js"><link rel="prefetch" href="/assets/js/45.47988f09.js"><link rel="prefetch" href="/assets/js/46.c89f87a7.js"><link rel="prefetch" href="/assets/js/47.da62c525.js"><link rel="prefetch" href="/assets/js/48.14e8582a.js"><link rel="prefetch" href="/assets/js/49.43c1e6d9.js"><link rel="prefetch" href="/assets/js/5.f3b2a75f.js"><link rel="prefetch" href="/assets/js/50.df122a49.js"><link rel="prefetch" href="/assets/js/51.76c5f73e.js"><link rel="prefetch" href="/assets/js/52.3355c42f.js"><link rel="prefetch" href="/assets/js/53.11e5b2b8.js"><link rel="prefetch" href="/assets/js/54.fbeb759b.js"><link rel="prefetch" href="/assets/js/55.94df427b.js"><link rel="prefetch" href="/assets/js/56.6d2f2843.js"><link rel="prefetch" href="/assets/js/57.8fe877e7.js"><link rel="prefetch" href="/assets/js/58.a1c615a5.js"><link rel="prefetch" href="/assets/js/59.3a72ea1c.js"><link rel="prefetch" href="/assets/js/6.5029a450.js"><link rel="prefetch" href="/assets/js/60.f69daa05.js"><link rel="prefetch" href="/assets/js/61.4558d16e.js"><link rel="prefetch" href="/assets/js/62.b8c4d998.js"><link rel="prefetch" href="/assets/js/63.62f73f54.js"><link rel="prefetch" href="/assets/js/64.294cd3d5.js"><link rel="prefetch" href="/assets/js/65.03979f20.js"><link rel="prefetch" href="/assets/js/66.185be225.js"><link rel="prefetch" href="/assets/js/67.00843cab.js"><link rel="prefetch" href="/assets/js/68.556f46d8.js"><link rel="prefetch" href="/assets/js/69.4d5aed6d.js"><link rel="prefetch" href="/assets/js/7.527d71e0.js"><link rel="prefetch" href="/assets/js/70.97532d18.js"><link rel="prefetch" href="/assets/js/71.3012cf0f.js"><link rel="prefetch" href="/assets/js/72.fb48c1c2.js"><link rel="prefetch" href="/assets/js/73.ce17bb0a.js"><link rel="prefetch" href="/assets/js/74.2d51ded9.js"><link rel="prefetch" href="/assets/js/75.9ce74516.js"><link rel="prefetch" href="/assets/js/76.0d01a419.js"><link rel="prefetch" href="/assets/js/77.1f01c28c.js"><link rel="prefetch" href="/assets/js/78.82e62087.js"><link rel="prefetch" href="/assets/js/79.9d345606.js"><link rel="prefetch" href="/assets/js/80.203e0c71.js"><link rel="prefetch" href="/assets/js/81.ea683e7e.js"><link rel="prefetch" href="/assets/js/82.00e87cdd.js"><link rel="prefetch" href="/assets/js/83.a4eb7ec6.js"><link rel="prefetch" href="/assets/js/84.43cc0681.js"><link rel="prefetch" href="/assets/js/85.685ee0bd.js"><link rel="prefetch" href="/assets/js/86.520d03d8.js"><link rel="prefetch" href="/assets/js/87.3be2955b.js"><link rel="prefetch" href="/assets/js/88.c399e81d.js"><link rel="prefetch" href="/assets/js/89.5e231fc1.js"><link rel="prefetch" href="/assets/js/90.43afd087.js"><link rel="prefetch" href="/assets/js/91.2b3dfc23.js"><link rel="prefetch" href="/assets/js/92.369c0e09.js"><link rel="prefetch" href="/assets/js/93.bb9d94ae.js"><link rel="prefetch" href="/assets/js/94.c39d6dca.js"><link rel="prefetch" href="/assets/js/95.b2ef8bdc.js"><link rel="prefetch" href="/assets/js/96.d9718865.js"><link rel="prefetch" href="/assets/js/97.a32df49d.js"><link rel="prefetch" href="/assets/js/98.e43ebad4.js"><link rel="prefetch" href="/assets/js/99.7ecb8c5a.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.2f354cfa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.51c3fc7f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HeroKing的个人笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="afterEnd" class="dropdown-title"><span class="title">afterEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="afterEnd" class="mobile-dropdown-title"><span class="title">afterEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/afterEnd/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/nginx/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/JMS/" class="nav-link">
  JMS
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/" class="nav-link router-link-active">
  After End
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="algorithms" class="dropdown-title"><span class="title">algorithms</span> <span class="arrow down"></span></button> <button type="button" aria-label="algorithms" class="mobile-dropdown-title"><span class="title">algorithms</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithms/" class="nav-link">
  Algorithms
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="frontEnd" class="dropdown-title"><span class="title">frontEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="frontEnd" class="mobile-dropdown-title"><span class="title">frontEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/autojs/" class="nav-link">
  Autojs
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/css/" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/demo/" class="nav-link">
  Demo
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link">
  Front End
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/ts/" class="nav-link">
  Ts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="life" class="dropdown-title"><span class="title">life</span> <span class="arrow down"></span></button> <button type="button" aria-label="life" class="mobile-dropdown-title"><span class="title">life</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/life/" class="nav-link">
  Life
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="network" class="dropdown-title"><span class="title">network</span> <span class="arrow down"></span></button> <button type="button" aria-label="network" class="mobile-dropdown-title"><span class="title">network</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/network/proxy/" class="nav-link">
  Proxy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="software" class="dropdown-title"><span class="title">software</span> <span class="arrow down"></span></button> <button type="button" aria-label="software" class="mobile-dropdown-title"><span class="title">software</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/software/ftp/" class="nav-link">
  Ftp
</a></li><li class="dropdown-item"><!----> <a href="/software/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/software/samba/" class="nav-link">
  Samba
</a></li><li class="dropdown-item"><!----> <a href="/software/" class="nav-link">
  Software
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="system" class="dropdown-title"><span class="title">system</span> <span class="arrow down"></span></button> <button type="button" aria-label="system" class="mobile-dropdown-title"><span class="title">system</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/system/Hackintosh/" class="nav-link">
  Hackintosh
</a></li><li class="dropdown-item"><!----> <a href="/system/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/system/" class="nav-link">
  System
</a></li><li class="dropdown-item"><!----> <a href="/system/windows/" class="nav-link">
  Windows
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="afterEnd" class="dropdown-title"><span class="title">afterEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="afterEnd" class="mobile-dropdown-title"><span class="title">afterEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/afterEnd/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/nginx/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/JMS/" class="nav-link">
  JMS
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/" class="nav-link router-link-active">
  After End
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="algorithms" class="dropdown-title"><span class="title">algorithms</span> <span class="arrow down"></span></button> <button type="button" aria-label="algorithms" class="mobile-dropdown-title"><span class="title">algorithms</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithms/" class="nav-link">
  Algorithms
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="frontEnd" class="dropdown-title"><span class="title">frontEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="frontEnd" class="mobile-dropdown-title"><span class="title">frontEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/autojs/" class="nav-link">
  Autojs
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/css/" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/demo/" class="nav-link">
  Demo
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link">
  Front End
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/ts/" class="nav-link">
  Ts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="life" class="dropdown-title"><span class="title">life</span> <span class="arrow down"></span></button> <button type="button" aria-label="life" class="mobile-dropdown-title"><span class="title">life</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/life/" class="nav-link">
  Life
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="network" class="dropdown-title"><span class="title">network</span> <span class="arrow down"></span></button> <button type="button" aria-label="network" class="mobile-dropdown-title"><span class="title">network</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/network/proxy/" class="nav-link">
  Proxy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="software" class="dropdown-title"><span class="title">software</span> <span class="arrow down"></span></button> <button type="button" aria-label="software" class="mobile-dropdown-title"><span class="title">software</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/software/ftp/" class="nav-link">
  Ftp
</a></li><li class="dropdown-item"><!----> <a href="/software/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/software/samba/" class="nav-link">
  Samba
</a></li><li class="dropdown-item"><!----> <a href="/software/" class="nav-link">
  Software
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="system" class="dropdown-title"><span class="title">system</span> <span class="arrow down"></span></button> <button type="button" aria-label="system" class="mobile-dropdown-title"><span class="title">system</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/system/Hackintosh/" class="nav-link">
  Hackintosh
</a></li><li class="dropdown-item"><!----> <a href="/system/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/system/" class="nav-link">
  System
</a></li><li class="dropdown-item"><!----> <a href="/system/windows/" class="nav-link">
  Windows
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/afterEnd/nginx/" aria-current="page" class="active sidebar-link">nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/afterEnd/nginx/#install" class="sidebar-link">Install</a></li><li class="sidebar-sub-header"><a href="/afterEnd/nginx/#config" class="sidebar-link">config</a></li><li class="sidebar-sub-header"><a href="/afterEnd/nginx/#example" class="sidebar-link">Example</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx"><a href="#nginx" class="header-anchor">#</a> nginx</h1> <h2 id="install"><a href="#install" class="header-anchor">#</a> Install</h2> <p>使用包管理器安装 nginx</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum search nginx <span class="token comment"># 可以看到有nginx包 也有nginx可动态加载的模块 nginx-mod-stream nginx-mod-devel  nginx-all-modules(带所有动态模块版本)</span>
yum <span class="token function">install</span> nginx <span class="token comment"># 或者其他nginx内容</span>

yum <span class="token function">install</span> nginx-mod-stream <span class="token parameter variable">-y</span>  <span class="token comment"># 安装stream模块</span>
<span class="token function">rpm</span> <span class="token parameter variable">-ql</span> nginx-mod-stream <span class="token comment"># 查看包nginx-mod-stream创建了哪些文件 如下</span>
<span class="token comment"># /usr/lib64/nginx/modules/ngx_stream_module.so 此文件被mod-stream.conf中 load_module</span>
<span class="token comment"># /usr/share/nginx/modules/mod-stream.conf 此文件被nginx.conf include到配置中</span>
</code></pre></div><blockquote><p>如果需要正向代理 请安装第三方 ngx_http_proxy_connect_module 模块 需要编译安装 使用 gost 也可以代理</p></blockquote> <h2 id="config"><a href="#config" class="header-anchor">#</a> config</h2> <h3 id="目录"><a href="#目录" class="header-anchor">#</a> 目录</h3> <ul><li>http 中 include /etc/nginx/conf.d/_.conf 用户分离 server 配置,多个虚拟主机的配置可以在<code>/etc/nginx/conf.d/</code>中创建<code>_.conf 文件</code>放置 server 配置</li> <li>server 中 include /etc/nginx/default.d/*.conf 因此在这个目录中的文件需要写 server 中的配置项</li></ul> <h3 id="配置项"><a href="#配置项" class="header-anchor">#</a> 配置项</h3> <p><a href="https://docs.nginx.com/nginx/admin-guide/web-server/web-server/">nginx 配置成 web 服务器上手文档</a></p> <p>为了方便描述,先定义几个变量
<code>locationPath</code>: server.location 配置项后面定义的路径, 路径匹配的话请写上末尾的<code>/</code> <code>resetUrl</code>: 客户端请求 url 裁减掉 locationPath 后的内容</p> <ul><li>listen 监听端口 listen 127.0.0.1:8080; listen 80 default_server[可选];</li> <li>server_name 指定主机名或者说域名,支持访问不同域名同端口区分项目 如 server_name example.org www.example.org;</li> <li><a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#location"> location </a> 路径匹配, 注意写法,路径后面带上/ 有多种匹配规则 <code>Nginx服务器会首先会检查多个location中是否有普通的uri匹配，如果有多个匹配，会先记住匹配度最高的那个。然后再检查正则匹配，这里切记正则匹配是有顺序的，从上到下依次匹配配成功，则结束检查，并就会使用这个location块处理此请求。如果正则匹配全部失败，就会使用刚才记录普通uri匹配度最高的那个location块处理此请求。</code></li> <li>location.root 设置当前 location 对应的根目录,url 访问的文件路径是 <code>${root}/${url}</code> (root 后路径带不带/ 无影响, 官方都是写上的)</li> <li>location.alias url1 当前 location 查找资源的目录,访问的资源路径是去掉 locationPath 的, 即<code>${alias}/${resetUrl}</code> ;注意: locationPath 和 url1 后末尾必须同时带'/'或者同时不带</li> <li>location.proxy_pass url1 <strong>url1 和 locationPath 至少有一个末尾以'/'结尾</strong>, urll 以'/'结尾,新 url 舍弃 locationPath 理解为<code>${url1}${resetUrl}</code>, 不以'/'结尾 理解成<code>${url1}${locationPath}${resetUrl}</code> 约等于原始路径 原文: https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass</li> <li>location.try_files 找不到 url 对应的资源时返回哪个文件 <code>try_files $uri $uri/ /index.html</code> 注意路径是对于 root 的路径</li></ul> <blockquote><p>测试目录 /test/index.html(页面 1) /test/dist/index.html(页面 2) /test/dist/assets/img.png
nginx 默认会把/dist 301 重定向到 /dist/</p></blockquote> <table><thead><tr><th>location</th> <th>配置</th> <th>页面 1</th> <th>页面 2</th> <th>图片</th> <th>备注</th></tr></thead> <tbody><tr><td>/</td> <td>root:E:/test</td> <td>/</td> <td>/dist</td> <td>/dist/assets/img.png</td> <td></td></tr> <tr><td>/</td> <td>root:E:/test/</td> <td>/</td> <td>/dist</td> <td>/dist/assets/img.png</td> <td></td></tr> <tr><td>/dist</td> <td>root:E:/test</td> <td>no</td> <td>/dist</td> <td>/dist/assets/img.png</td> <td></td></tr> <tr><td>/dist/</td> <td>root:E:/test/</td> <td>no</td> <td>/dist</td> <td>/dist/assets/img.png</td> <td></td></tr> <tr><td>~ .(png)$</td> <td>root:E:/test</td> <td>no</td> <td>no</td> <td>/dist/assets/img.png</td> <td></td></tr> <tr><td>=/index.html</td> <td>root:E:/test</td> <td>/index.html</td> <td>no</td> <td>no</td> <td>url 完全匹配</td></tr> <tr><td>/Dist/</td> <td>root:E:/test</td> <td>no</td> <td>/dist</td> <td>no</td> <td></td></tr> <tr><td>/</td> <td>proxy_pass:http://localhost:300</td> <td>/</td> <td>/dist</td> <td>/dist/assets/img.png</td> <td></td></tr> <tr><td>/dist/</td> <td>proxy_pass:http://localhost:300</td> <td>no</td> <td>/dist</td> <td>/dist/assets/img.png</td> <td>proxy_pass 后面内容无 / 写法正确时则将客户端原始 url 转发</td></tr> <tr><td>/dist/</td> <td>proxy_pass:http://localhost:300/</td> <td>/dist</td> <td>/dist/dist</td> <td>/dist/dist/assets/img.png</td> <td>所以 proxy_pass 改成 :3000/dist/跟上一阿行同效果</td></tr> <tr><td>/</td> <td>proxy_pass:http://localhost:300/dist</td> <td>no</td> <td>/</td> <td>访问不到!!</td> <td>客户端/dist 会被处理成/distdist 相当于根据 location 匹配后拼接</td></tr> <tr><td>/</td> <td>proxy_pass:http://localhost:300/dist/</td> <td>no</td> <td>/</td> <td>/assets/img.png</td> <td></td></tr> <tr><td>/</td> <td>alias:E:/test/</td> <td>/</td> <td>/dist</td> <td>/dist/assets/img.png</td> <td></td></tr> <tr><td>/dist/</td> <td>alias:E:/test/</td> <td>/dist</td> <td>/dist/dist</td> <td>/dist/dist/assets/img.png</td> <td>alias 后面加上 dist 目录即可省掉后面 dist 前缀</td></tr></tbody></table> <h3 id="location-规则"><a href="#location-规则" class="header-anchor">#</a> location 规则</h3> <ul><li>&quot;=&quot; 精准匹配, 必须完全相同才能匹配上, 匹配后停止后续匹配，直接执行该匹配<div class="language-shell extra-class"><pre class="language-shell"><code>  location <span class="token operator">=</span> /abc <span class="token punctuation">{</span>
  <span class="token comment"># do something 表示只有当请求的URI为“/abc”时才会匹配到这个location，其他的URI都不会匹配到。</span>
  <span class="token punctuation">}</span>
</code></pre></div></li> <li>“^~” 前缀匹配 找到普通 uri 匹配度最高的那个 location 后，立即处理此请求，并不再进行正则匹配<div class="language-shell extra-class"><pre class="language-shell"><code>  location ^~ /abc/ <span class="token punctuation">{</span>
  <span class="token comment"># do something  表示当请求的URI以“/abc”开头时，就匹配到这个location。如果有多个location都匹配到了同一个URI，那么nginx会选择最长的前缀匹配来处理请求。</span>
  <span class="token punctuation">}</span>
</code></pre></div></li> <li>“~”，执行正则匹配，区分大小写 按顺序匹配，一旦匹配上即停止后续匹配</li> <li>“~*”，执行正则匹配，忽略大小写 按顺序匹配，一旦匹配上即停止后续匹配</li> <li>普通匹配 不加任何规则时，前缀匹配，继续更长前缀匹配和正则匹配。</li></ul> <h4 id="匹配顺序"><a href="#匹配顺序" class="header-anchor">#</a> 匹配顺序</h4> <p>在 nginx 中，location 指令的匹配顺序是按照精确匹配、前缀匹配、正则表达式匹配的顺序进行。也就是说，当有多个 location 都可以匹配到同一个 URI 时，会优先选择精确匹配，然后是前缀匹配，最后是正则表达式匹配。</p> <h3 id="多-server-模块"><a href="#多-server-模块" class="header-anchor">#</a> 多 server 模块</h3> <ol><li>首先选择所有的字符串完全匹配的 server_name。（完全匹配）</li> <li>选择通配符在前面的 server_name，如*.mumusir.com www.mumusir.com</li> <li>选择通配符在后面的 server_name，如 mumusir.* mumusir.com mumusir.cn</li> <li>最后选择使用正则表达式匹配的 server_name，如~^www.(.*).com$</li> <li>如果全部都没有匹配到，那么将选择在 listen 配置项后加入[default_server]的 server 块</li> <li>如果没写，那么就找到匹配 listen 端口的第一个 Server 块的配置文件 #如果通过 ip 访问，会直接到 5，判断是否有 default_server 的 server 块，就走 6</li></ol> <h3 id="重定向"><a href="#重定向" class="header-anchor">#</a> 重定向</h3> <p>return/rewrite关键字
https://nginx.org/en/docs/http/ngx_http_rewrite_module.html</p> <h2 id="example"><a href="#example" class="header-anchor">#</a> Example</h2> <h3 id="代理-api-请求"><a href="#代理-api-请求" class="header-anchor">#</a> 代理/api 请求</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>location /api/ <span class="token punctuation">{</span>
  proxy_pass http://IP:Port/<span class="token punctuation">;</span>
  proxy_connect_timeout 15s<span class="token punctuation">;</span>
  proxy_send_timeout 15s<span class="token punctuation">;</span>
  proxy_read_timeout 15s<span class="token punctuation">;</span>
  proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
  proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
  proxy_set_header X-Forwarded-Proto http<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="一个-server-块托管多个前端项目"><a href="#一个-server-块托管多个前端项目" class="header-anchor">#</a> 一个 server 块托管多个前端项目</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 资源路径 /new_home/books/index.html</span>
location <span class="token operator">/</span>books <span class="token punctuation">{</span>
  root <span class="token operator">/</span>new_home<span class="token punctuation">;</span>
  try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>books<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  index  index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>或者直接设置 root 路径为多个项目资源的存放目录</p> <div class="language-shell extra-class"><pre class="language-shell"><code>root /var/www/aml<span class="token punctuation">;</span>
index index.html<span class="token punctuation">;</span>
</code></pre></div><h3 id="项目文件目录与-locationpath-不一致"><a href="#项目文件目录与-locationpath-不一致" class="header-anchor">#</a> 项目文件目录与 locationPath 不一致</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>  location /ems/ <span class="token punctuation">{</span>
    <span class="token builtin class-name">alias</span> E:/test/dist/<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="一个-server-块反向代理多个服务"><a href="#一个-server-块反向代理多个服务" class="header-anchor">#</a> 一个 server 块反向代理多个服务</h3> <ul><li>方案一: 通过 location 去区分不同服务主机, proxy_pass 使用末尾'/'的方式, 但是要求服务的所有资源带固定前缀 或者用的'./'相对路径加载资源</li> <li>方案二: 使用虚拟主机功能</li></ul> <h3 id="v2ray-配置"><a href="#v2ray-配置" class="header-anchor">#</a> v2ray 配置</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>location ^~ /ray <span class="token punctuation">{</span> <span class="token comment"># 与 V2Ray 配置中的 path 保持一致</span>
    proxy_redirect off<span class="token punctuation">;</span>
    proxy_pass http://127.0.0.1:10000<span class="token punctuation">;</span><span class="token comment">#假设WebSocket监听在环回地址的10000端口上</span>
    proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>
    proxy_set_header Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
    proxy_set_header Connection <span class="token string">&quot;upgrade&quot;</span><span class="token punctuation">;</span>
    proxy_set_header Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
    <span class="token comment"># Show realip in v2ray access.log</span>
    proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
  <span class="token string">&quot;log&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;loglevel&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;warning&quot;</span>,
    <span class="token string">&quot;access&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/log/v2ray/access.log&quot;</span>,
    <span class="token string">&quot;error&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/log/v2ray/error.log&quot;</span>
  <span class="token punctuation">}</span>,

  <span class="token string">&quot;inbounds&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;port&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10000</span>,
      <span class="token string">&quot;listen&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;127.0.0.1&quot;</span>,
      <span class="token string">&quot;protocol&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;vmess&quot;</span>,
      <span class="token string">&quot;settings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;clients&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;b831381d-6384-4d53-ad4f&quot;</span>,
            <span class="token string">&quot;alterId&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;streamSettings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;network&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ws&quot;</span>,
        <span class="token string">&quot;wsSettings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/ray&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>,
  <span class="token string">&quot;outbounds&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;protocol&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;freedom&quot;</span>,
      <span class="token string">&quot;settings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="图片静态资源缓存"><a href="#图片静态资源缓存" class="header-anchor">#</a> 图片静态资源缓存</h3> <p>每次前端打包拷贝到服务器上都会是新的文件, nginx 默认使用文件修改时间和大小生成 ETag, 如果想用文件内容的散列值生成 ETag, 可以使用 etag_hash 指令来进行配置, 所以想要缓存还是用强缓存</p> <p>在设置缓存的同时<code>注意 NGINX location 的匹配顺序</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>  <span class="token comment">#静态资料目录</span>
  location ~* <span class="token punctuation">\</span>.<span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>bmp<span class="token operator">|</span>png<span class="token operator">|</span>ico<span class="token operator">|</span>txt<span class="token operator">|</span>css<span class="token punctuation">)</span>$
  <span class="token punctuation">{</span>
     expires  30d<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bdff9417.js" defer></script><script src="/assets/js/2.877b15ed.js" defer></script><script src="/assets/js/1.ee4b0e89.js" defer></script><script src="/assets/js/28.063c60f6.js" defer></script>
  </body>
</html>
