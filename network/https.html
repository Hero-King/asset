<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Https 权威指南 | HeroKing的个人笔记</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link href="https://cdn.bootcdn.net/ajax/libs/normalize/8.0.1/normalize.min.css" rel="stylesheet">
    <script src="https://hm.baidu.com/hm.js?3691b93bb6fcef0775ef18a936452b97" defer="true"></script>
    <meta name="description" content="学习犹如逆水行舟,不进则退">
    
    <link rel="preload" href="/assets/css/0.styles.51c3fc7f.css" as="style"><link rel="preload" href="/assets/js/app.52c91322.js" as="script"><link rel="preload" href="/assets/js/2.163e2f28.js" as="script"><link rel="preload" href="/assets/js/1.f9594dd0.js" as="script"><link rel="preload" href="/assets/js/72.9c48fd21.js" as="script"><link rel="prefetch" href="/assets/js/10.179e31cc.js"><link rel="prefetch" href="/assets/js/100.a2da16f1.js"><link rel="prefetch" href="/assets/js/11.0e411808.js"><link rel="prefetch" href="/assets/js/12.947f28db.js"><link rel="prefetch" href="/assets/js/13.14b6263c.js"><link rel="prefetch" href="/assets/js/14.d0c47c93.js"><link rel="prefetch" href="/assets/js/15.148f04fa.js"><link rel="prefetch" href="/assets/js/16.e6f33590.js"><link rel="prefetch" href="/assets/js/17.ab2d7eb1.js"><link rel="prefetch" href="/assets/js/18.5d8b1599.js"><link rel="prefetch" href="/assets/js/19.24ad168e.js"><link rel="prefetch" href="/assets/js/20.41a6a709.js"><link rel="prefetch" href="/assets/js/21.8218c0fb.js"><link rel="prefetch" href="/assets/js/22.603a3453.js"><link rel="prefetch" href="/assets/js/23.f4004600.js"><link rel="prefetch" href="/assets/js/24.d0446a23.js"><link rel="prefetch" href="/assets/js/25.4015af20.js"><link rel="prefetch" href="/assets/js/26.95e367fb.js"><link rel="prefetch" href="/assets/js/27.b7140a23.js"><link rel="prefetch" href="/assets/js/28.03cb7016.js"><link rel="prefetch" href="/assets/js/29.f939fbc6.js"><link rel="prefetch" href="/assets/js/3.678789c9.js"><link rel="prefetch" href="/assets/js/30.a760633a.js"><link rel="prefetch" href="/assets/js/31.3f298ff5.js"><link rel="prefetch" href="/assets/js/32.6cdbe59a.js"><link rel="prefetch" href="/assets/js/33.cbd36427.js"><link rel="prefetch" href="/assets/js/34.6230043f.js"><link rel="prefetch" href="/assets/js/35.ef5c8a34.js"><link rel="prefetch" href="/assets/js/36.5be64e88.js"><link rel="prefetch" href="/assets/js/37.dfc3b440.js"><link rel="prefetch" href="/assets/js/38.6a04c56e.js"><link rel="prefetch" href="/assets/js/39.c3f3a91b.js"><link rel="prefetch" href="/assets/js/4.30e44ed7.js"><link rel="prefetch" href="/assets/js/40.cda9d865.js"><link rel="prefetch" href="/assets/js/41.4a21d8ec.js"><link rel="prefetch" href="/assets/js/42.875b2f31.js"><link rel="prefetch" href="/assets/js/43.dcf673ca.js"><link rel="prefetch" href="/assets/js/44.b08ecd05.js"><link rel="prefetch" href="/assets/js/45.0fef276e.js"><link rel="prefetch" href="/assets/js/46.08975b0f.js"><link rel="prefetch" href="/assets/js/47.a8a0d0e8.js"><link rel="prefetch" href="/assets/js/48.484656ac.js"><link rel="prefetch" href="/assets/js/49.7d93d7fe.js"><link rel="prefetch" href="/assets/js/5.6beae35f.js"><link rel="prefetch" href="/assets/js/50.51c8b216.js"><link rel="prefetch" href="/assets/js/51.f973567d.js"><link rel="prefetch" href="/assets/js/52.6501423b.js"><link rel="prefetch" href="/assets/js/53.ba00f3d2.js"><link rel="prefetch" href="/assets/js/54.161545a4.js"><link rel="prefetch" href="/assets/js/55.70dea2a8.js"><link rel="prefetch" href="/assets/js/56.5c3c6b6c.js"><link rel="prefetch" href="/assets/js/57.8c781bf8.js"><link rel="prefetch" href="/assets/js/58.ce6d2f78.js"><link rel="prefetch" href="/assets/js/59.54658a12.js"><link rel="prefetch" href="/assets/js/6.e78facd0.js"><link rel="prefetch" href="/assets/js/60.67d6e287.js"><link rel="prefetch" href="/assets/js/61.4183ad7c.js"><link rel="prefetch" href="/assets/js/62.0024316d.js"><link rel="prefetch" href="/assets/js/63.105d731b.js"><link rel="prefetch" href="/assets/js/64.2b24cf92.js"><link rel="prefetch" href="/assets/js/65.90c5c7d1.js"><link rel="prefetch" href="/assets/js/66.e984a9e5.js"><link rel="prefetch" href="/assets/js/67.87930007.js"><link rel="prefetch" href="/assets/js/68.3426008a.js"><link rel="prefetch" href="/assets/js/69.f13b68e6.js"><link rel="prefetch" href="/assets/js/7.c3aab524.js"><link rel="prefetch" href="/assets/js/70.69f21f98.js"><link rel="prefetch" href="/assets/js/71.67a72bf5.js"><link rel="prefetch" href="/assets/js/73.6e5611f9.js"><link rel="prefetch" href="/assets/js/74.52d0441e.js"><link rel="prefetch" href="/assets/js/75.5dc05441.js"><link rel="prefetch" href="/assets/js/76.cd45adcb.js"><link rel="prefetch" href="/assets/js/77.f953fc79.js"><link rel="prefetch" href="/assets/js/78.e9caab6e.js"><link rel="prefetch" href="/assets/js/79.8b7301be.js"><link rel="prefetch" href="/assets/js/80.0df4d93a.js"><link rel="prefetch" href="/assets/js/81.b54281ce.js"><link rel="prefetch" href="/assets/js/82.2a223009.js"><link rel="prefetch" href="/assets/js/83.4dc9bdbf.js"><link rel="prefetch" href="/assets/js/84.d77a6784.js"><link rel="prefetch" href="/assets/js/85.75e7aba3.js"><link rel="prefetch" href="/assets/js/86.b9ec5bce.js"><link rel="prefetch" href="/assets/js/87.adb5d482.js"><link rel="prefetch" href="/assets/js/88.86bcee6d.js"><link rel="prefetch" href="/assets/js/89.350d0fb3.js"><link rel="prefetch" href="/assets/js/90.d5bf7676.js"><link rel="prefetch" href="/assets/js/91.cb157e9e.js"><link rel="prefetch" href="/assets/js/92.7c2880c4.js"><link rel="prefetch" href="/assets/js/93.b365d13c.js"><link rel="prefetch" href="/assets/js/94.39a9943c.js"><link rel="prefetch" href="/assets/js/95.c4919abd.js"><link rel="prefetch" href="/assets/js/96.1f3f53d2.js"><link rel="prefetch" href="/assets/js/97.e66f15bb.js"><link rel="prefetch" href="/assets/js/98.20e46b04.js"><link rel="prefetch" href="/assets/js/99.7383c9a9.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.2f354cfa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.51c3fc7f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HeroKing的个人笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="afterEnd" class="dropdown-title"><span class="title">afterEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="afterEnd" class="mobile-dropdown-title"><span class="title">afterEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/afterEnd/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/JMS/" class="nav-link">
  JMS
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/" class="nav-link">
  After End
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="algorithms" class="dropdown-title"><span class="title">algorithms</span> <span class="arrow down"></span></button> <button type="button" aria-label="algorithms" class="mobile-dropdown-title"><span class="title">algorithms</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithms/" class="nav-link">
  Algorithms
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="frontEnd" class="dropdown-title"><span class="title">frontEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="frontEnd" class="mobile-dropdown-title"><span class="title">frontEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/autojs/" class="nav-link">
  Autojs
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/css/" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/demo/" class="nav-link">
  Demo
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link">
  Front End
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/ts/" class="nav-link">
  Ts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="life" class="dropdown-title"><span class="title">life</span> <span class="arrow down"></span></button> <button type="button" aria-label="life" class="mobile-dropdown-title"><span class="title">life</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/life/" class="nav-link">
  Life
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="network" class="dropdown-title"><span class="title">network</span> <span class="arrow down"></span></button> <button type="button" aria-label="network" class="mobile-dropdown-title"><span class="title">network</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link router-link-active">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/network/proxy/" class="nav-link">
  Proxy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="software" class="dropdown-title"><span class="title">software</span> <span class="arrow down"></span></button> <button type="button" aria-label="software" class="mobile-dropdown-title"><span class="title">software</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/software/ftp/" class="nav-link">
  Ftp
</a></li><li class="dropdown-item"><!----> <a href="/software/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/software/samba/" class="nav-link">
  Samba
</a></li><li class="dropdown-item"><!----> <a href="/software/" class="nav-link">
  Software
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="system" class="dropdown-title"><span class="title">system</span> <span class="arrow down"></span></button> <button type="button" aria-label="system" class="mobile-dropdown-title"><span class="title">system</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/system/Hackintosh/" class="nav-link">
  Hackintosh
</a></li><li class="dropdown-item"><!----> <a href="/system/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/system/" class="nav-link">
  System
</a></li><li class="dropdown-item"><!----> <a href="/system/windows/" class="nav-link">
  Windows
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="afterEnd" class="dropdown-title"><span class="title">afterEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="afterEnd" class="mobile-dropdown-title"><span class="title">afterEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/afterEnd/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/JMS/" class="nav-link">
  JMS
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/" class="nav-link">
  After End
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="algorithms" class="dropdown-title"><span class="title">algorithms</span> <span class="arrow down"></span></button> <button type="button" aria-label="algorithms" class="mobile-dropdown-title"><span class="title">algorithms</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithms/" class="nav-link">
  Algorithms
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="frontEnd" class="dropdown-title"><span class="title">frontEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="frontEnd" class="mobile-dropdown-title"><span class="title">frontEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/autojs/" class="nav-link">
  Autojs
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/css/" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/demo/" class="nav-link">
  Demo
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link">
  Front End
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/ts/" class="nav-link">
  Ts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="life" class="dropdown-title"><span class="title">life</span> <span class="arrow down"></span></button> <button type="button" aria-label="life" class="mobile-dropdown-title"><span class="title">life</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/life/" class="nav-link">
  Life
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="network" class="dropdown-title"><span class="title">network</span> <span class="arrow down"></span></button> <button type="button" aria-label="network" class="mobile-dropdown-title"><span class="title">network</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link router-link-active">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/network/proxy/" class="nav-link">
  Proxy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="software" class="dropdown-title"><span class="title">software</span> <span class="arrow down"></span></button> <button type="button" aria-label="software" class="mobile-dropdown-title"><span class="title">software</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/software/ftp/" class="nav-link">
  Ftp
</a></li><li class="dropdown-item"><!----> <a href="/software/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/software/samba/" class="nav-link">
  Samba
</a></li><li class="dropdown-item"><!----> <a href="/software/" class="nav-link">
  Software
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="system" class="dropdown-title"><span class="title">system</span> <span class="arrow down"></span></button> <button type="button" aria-label="system" class="mobile-dropdown-title"><span class="title">system</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/system/Hackintosh/" class="nav-link">
  Hackintosh
</a></li><li class="dropdown-item"><!----> <a href="/system/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/system/" class="nav-link">
  System
</a></li><li class="dropdown-item"><!----> <a href="/system/windows/" class="nav-link">
  Windows
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Network</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/network/" aria-current="page" class="sidebar-link">网络</a></li><li><a href="/network/DDNS.html" class="sidebar-link">DDNS</a></li><li><a href="/network/home.html" class="sidebar-link">家庭网络中客厅到弱电箱只有一根网线怎么办?单臂路由?还是...</a></li><li><a href="/network/http.html" class="sidebar-link">图解 HTTP 笔记</a></li><li><a href="/network/https.html" aria-current="page" class="active sidebar-link">Https 权威指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/https.html#ssl-tls" class="sidebar-link">SSL/TLS</a></li><li class="sidebar-sub-header"><a href="/network/https.html#协议" class="sidebar-link">协议</a></li><li class="sidebar-sub-header"><a href="/network/https.html#部署-tls" class="sidebar-link">部署 TLS</a></li><li class="sidebar-sub-header"><a href="/network/https.html#openssl" class="sidebar-link">openssl</a></li><li class="sidebar-sub-header"><a href="/network/https.html#抓包" class="sidebar-link">抓包</a></li></ul></li><li><a href="/network/iptv.html" class="sidebar-link">IPTV</a></li><li><a href="/network/modem.html" class="sidebar-link">光猫</a></li><li><a href="/network/openwrt.html" class="sidebar-link">openwrt</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="https-权威指南"><a href="#https-权威指南" class="header-anchor">#</a> Https 权威指南</h1> <h2 id="ssl-tls"><a href="#ssl-tls" class="header-anchor">#</a> SSL/TLS</h2> <h3 id="重要性"><a href="#重要性" class="header-anchor">#</a> 重要性</h3> <p>所有连接到互联网的设备都有一个共同点，它们依赖安全套接字层（secure socket layer，SSL）
和传输层安全（transport layer security，TLS）协议保护传输的信息。</p> <h3 id="网络模型"><a href="#网络模型" class="header-anchor">#</a> 网络模型:</h3> <p>SSL 和 TLS 它用于 TCP 协议之上，上层协议
（如 HTTP）之下。当不需要加密时，可以将 TLS 从模型中去掉，这并不会对上层协议产生影响（它
们将直接与 TCP 协同工作）。当需要加密时，就可以利用 TLS 加密 HTTP，以及其他 TCP 协议（比
如 SMTP、IMAP 等）。</p> <h3 id="密码学"><a href="#密码学" class="header-anchor">#</a> 密码学</h3> <p>**散列函数（hash function）**是将任意长度的输入转化为定长输出的算法。散列函数的结果经
常被简称为散列（hash）。 散列函数经常被称为指纹、消息摘要，或者简单称为摘要。
现在使用最为广泛的散列函数是 SHA1，它的输出是 160 位。因为 SHA1 已经变弱，所以建议
升级为 SHA256 的变种。与密码不同，散列函数的强度并不与散列长度对等。</p> <p><strong>非对称加密</strong>（asymmetric encryption）又称为公钥加密（public key cryptography），它是另一
种方法，使用两个密钥，而不是一个；其中一个密钥是私密的，另一个是公开的。顾名思义，一
个密钥用于私人，另一个密钥将会被所有人共享。这两个密钥之间存在一些特殊的数学关系，使
得密钥具备一些有用的特性。如果你利用某人的公钥加密数据，那么只有他们对应的私钥能够解
密，如图 1-5 所示。从另一个方面讲，如果某人用私钥加密数据，任何人都可以利用对应的公钥
解开消息。后面这种操作不提供机密性，但可以用作数字签名。 RSA 是目前最普遍部署的非对称加密算法</p> <p><strong>数字签名</strong> 我们可以利用公钥密码的非对
称性设计出一种算法，使用私钥对消息进行签名，并使用对应的公钥验证它。
(1) 计算希望签名的文档的散列。不论输入文档的长度如何，输出长度总是固定的。比如，
使用 SHA256 就是 256 位。
(2) 对结果散列和一些额外的元数据进行编码。比如，接收方需要知道你使用的散列算法，
否则不能处理签名。
(3) 使用私钥加密编码过的数据，其结果就是签名，可以追加到文档中作为身份验证的依据。
为了验证签名，接收方接收文档并使用相同的散列算法独立计算文档散列。接着，她使用公
钥对消息进行解密，将散列解码出来，再确认使用的散列算法是否正确，解密出的散列是否与本
地计算的相同。这个方案的强度取决于加密、散列以及编码组件各自的强度。</p> <blockquote><p>并非所有的数字签名算法都与 RSA 的工作方式一致。事实上，RSA 是一个特例，因为
它可以同时用于加密和数字签名。其他流行的公钥密码算法则不能用于加密，比如
DSA 和 ECDSA，它们依赖其他方式进行签名。</p></blockquote> <h2 id="协议"><a href="#协议" class="header-anchor">#</a> 协议</h2> <h3 id="握手协议"><a href="#握手协议" class="header-anchor">#</a> 握手协议</h3> <p>在这个过程中，通信双方协商连接参数，并且完成身份验证。根据使用的功能的不同，整个过程通常需要交换 6~10 条消息。
根据配置和支持的协议扩展的不同，交换过程可能有许多变种。在使用中经常可以观察到以下三种流程：(1) 完整的握手，
对服务器进行身份验证；(2) 恢复之前的会话采用的简短握手；(3) 对客户端和服务器都进行身份
验证的握手。</p> <h3 id="tls-建立过程"><a href="#tls-建立过程" class="header-anchor">#</a> TLS 建立过程</h3> <p>(1) 客户端开始新的握手，并将自身支持的功能提交给服务器。<br>
(2) 服务器选择连接参数。<br>
(3) 服务器发送其证书链（仅当需要服务器身份验证时）。<br>
(4) 根据选择的密钥交换方式，服务器发送生成主密钥的额外信息。<br>
(5) 服务器通知自己完成了协商过程。<br>
(6) 客户端发送生成主密钥所需的额外信息。<br>
(7) 客户端切换加密方式并通知服务器。<br>
(8) 客户端计算发送和接收到的握手消息的 MAC 并发送。<br>
(9) 服务器切换加密方式并通知客户端。<br>
(10) 服务器计算发送和接收到的握手消息的 MAC 并发送。</p> <h3 id="秘钥交换算法"><a href="#秘钥交换算法" class="header-anchor">#</a> 秘钥交换算法</h3> <p>dh_anon Diffie-Hellman（DH）密钥交换，未经身份验证<br>
dhe_rsa 临时 DH 密钥交换，使用 RSA 身份验证<br>
ecdh_anon 临时椭圆曲线 DH（elliptic curve DH，ECDH）密钥交换，未经身份验证（RFC 4492）<br>
ecdhe_rsa 临时 ECDH 密钥交换，使用 RSA 身份验证（RFC 4492）<br>
ecdhe_ecdsa 临时 ECDH 密钥交换，使用 ECDSA 身份验证（RFC 4492）<br>
krb5 Kerberos 密钥交换（RFC 2712）<br>
rsa RSA 密钥交换和身份验证<br>
psk 预共享密钥（pre-shared key，PSK）密钥交换和身份验证（RFC 4279）<br>
dhe_psk 临时 DH 密钥交换，使用 PSK 身份验证（RFC 4279）<br>
rsa_psk PSK 密钥交换，使用 RSA 身份验证（RFC 4279）<br>
srp 安全远程密码（secure remote password，SRP）密钥交换和身份验证（RFC 5054）</p> <p>使用哪一种密钥交换由协商的套件所决定。一旦套件决定下来，两端都能了解按照哪种算法
继续操作。实际使用的密钥交换算法主要有以下 4 种。
RSA
DHE_RSA (临时 Diffie-Hellman（ephemeral Diffie-Hellman，DHE）密钥交换 在 TLS 中，DHE 通常与 RSA 身份验证联合使用。)
ECDHE_RSA 和 ECDHE_ECDSA</p> <h3 id="加密"><a href="#加密" class="header-anchor">#</a> 加密</h3> <p>TLS 可以使用各种方法加密数据，比如使用 3DES、AES、ARIA、CAMELLIA、RC4 或者 SEED
等算法。目前使用最为广泛的加密算法是 AES。</p> <h2 id="部署-tls"><a href="#部署-tls" class="header-anchor">#</a> 部署 TLS</h2> <h3 id="证书"><a href="#证书" class="header-anchor">#</a> 证书</h3> <p>证书主要有三种类型：域名验证（domain validated，DV）、组织验证（organization validated，
OV）和扩展验证（extended validation，EV）。DV 证书的签发是自动的，通常也是最便宜的，一
般的网站使用 DV 证书就足够了。OV 证书需要验证域名拥有者的公司信息，并且在证书中包含公
司信息。尽管如此，浏览器实际上并不区分 OV 和 DV 证书，也不会展示出证书包含的所有信息。</p> <h4 id="证书主机名"><a href="#证书主机名" class="header-anchor">#</a> 证书主机名</h4> <p>证书的主要作用就是为保障用户安全顺畅地访问域名建议合适的信任机制。在互联网上，用
户经常会收到一些证书域名不匹配的警告，这往往是由于使用的证书不能匹配该域名的不同变体
（比如证书域名是www.example.com，无法匹配example.com域名）。
为了避免上述问题，请遵守一个简单的规则：只要有一个 DNS 解析指向你的 TLS 服务器，就务必保证你的证书包括了这个 DNS 域名。</p> <h3 id="证书共享"><a href="#证书共享" class="header-anchor">#</a> 证书共享</h3> <p>证书共享大致分为两种类型。第一种：你可以签发一个包含所有需要域名的证书（例如，
www.example.com、example.com和log.example.com）。第二种：你可以签发一个泛域名证书，可
用于所有关联的子域名（例如，签发一个*.example.com 和 example.com 的泛域名证书）。</p> <p>多域名证书的优点是降低了维护成本并且可以让多个 https 网站共用一个 IP 地址。这种证书在
CDN 上使用很普遍，因为 CDN 经常会需要对很多不同的外部用户提供服务。</p> <p>原则上，使用多域名证书并没有什么问题，但前提是它不会降低你的系统安全性，而现实是
这种证书的使用确实会对安全性有影响。从本质上来讲，当多个域名共用一个证书时，事实上它
们也就共用了一个相同的私钥。因此，当你的一组网站是由不同团队运营或者根本各不相关时，
就不应该对这些网站使用多域名证书。因为如果其中一个网站被攻击，被窃取的私钥就可以用来
攻击所有共用这个证书的其他网站，另外在发生攻击后，你也需要对这组网站全部更新一遍密钥。</p> <h2 id="openssl"><a href="#openssl" class="header-anchor">#</a> openssl</h2> <h3 id="密钥和证书管理"><a href="#密钥和证书管理" class="header-anchor">#</a> 密钥和证书管理</h3> <p>大多数用户借助 OpenSSL 是因为希望配置并运行能够支持 SSL 的 Web 服务器。整个过程包括 3
个步骤：(1) 生成强加密的私钥；(2) 创建证书签名申请（certificate signing request，CSR）并且发
送给 CA；(3) 在你的 Web 服务器上安装 CA 提供的证书。这些步骤（还有其他一些）会在本节详细
说明。</p> <ul><li><p>生成密钥 - 秘钥算法 (OpenSSL 支持 RSA、DSA 和 ECDSA 密钥，但是在实际使用场景中不是所有密钥类型都适
用的。例如对于 Web 服务器的密钥，所有人都使用 RSA，因为 DSA 一般因为效率问题会
限制在 1024 位（Internet Explorer 不支持更长的 DSA 密钥），而 ECDSA 还没有被大部分的
CA 支持。对于 SSH 来说，一般都是使用 DSA 和 RSA，而不是所有的客户端都支持 ECDSA
算法。) - 密钥长度 (默认的密钥长度一般都不够安全，所以我们需要指定要配置的密钥长度。例如 RSA 密钥
默认的长度是 512 位，非常不安全。如果今天你的服务器上还是用 512 位的密钥，入侵者可以先获取你的证书，使用暴力方式来算出对应的私钥，之后就可以冒充你的站点了。
现在，一般认为 2048 位的 RSA 密钥是安全的，所以你应该采用这个长度的密钥。DSA 密
钥也应该不少于 2048 位，ECDSA 密钥则应该是 256 位以上。) - 密码(强烈建议使用密码去保存密钥，虽然这是只一个可选项。受密码保护的密钥可以被安全地存储、传输以及备份。)</p></li> <li><p>创建证书签名申请 （certificate signing request，CSR）(要求 CA
给证书签名的一种正式申请，该申请包含申请证书的实体的公钥以及该实体的某些信息。该数据
将成为证书的一部分)</p></li> <li><p>自签名证书(如果你只是想安装一台自己使用的 TLS 服务器，那么可以不必找 CA 去获取一个公开信任的
证书，自己就可以直接签发一个。)</p> <blockquote><p>申请权威机构的 CA 证书 VS 自签名 CA 证书<br>
1、权威 CA 机构申请的证书要花银子，自签证书不要银子
2、自签证书会出现 google 浏览器不认的情况，比较麻烦。漏洞也多，对安全不利。<br>
3、使用机构签发的证书时候需要联网签发，内网机器不用想<br> <strong>所以公网服务踏实的买证书，内网机器踏实的自签证书。</strong></p></blockquote></li> <li><p>创建对多个主机名有效的证书</p></li></ul> <h2 id="抓包"><a href="#抓包" class="header-anchor">#</a> 抓包</h2> <p>常规 HTTPS 请求:</p> <div class="language-plantuml extra-class"><pre class="language-plantuml"><code><span class="token delimiter punctuation">@startuml</span>
<span class="token keyword">title</span> 正常HTTPS连接流程

<span class="token keyword">participant</span> 客户端
<span class="token keyword">participant</span> 服务器

客户端 <span class="token arrow operator">-&gt;</span> 服务器<span class="token punctuation">:</span> ClientHello <span class="token punctuation">(</span>支持的加密套件<span class="token punctuation">)</span>
服务器 <span class="token arrow operator">-&gt;</span> 客户端<span class="token punctuation">:</span> ServerHello <span class="token punctuation">(</span>选择的加密套件<span class="token punctuation">)</span>\n+ 服务器证书
客户端 <span class="token arrow operator">-&gt;</span> 客户端<span class="token punctuation">:</span> 验证证书有效性
客户端 <span class="token arrow operator">-&gt;</span> 服务器<span class="token punctuation">:</span> 预主密钥<span class="token punctuation">(</span>用服务器公钥加密<span class="token punctuation">)</span>
服务器 <span class="token arrow operator">-&gt;</span> 服务器<span class="token punctuation">:</span> 用私钥解密预主密钥
客户端 <span class="token arrow operator">-&gt;</span> 服务器<span class="token punctuation">:</span> 加密通信开始
服务器 <span class="token arrow operator">-&gt;</span> 客户端<span class="token punctuation">:</span> 加密通信开始

客户端 <span class="token arrow operator">-&gt;</span> 服务器<span class="token punctuation">:</span> 加密的应用数据
服务器 <span class="token arrow operator">-&gt;</span> 客户端<span class="token punctuation">:</span> 加密的应用数据
<span class="token delimiter punctuation">@enduml</span>
</code></pre></div><h3 id="中间人攻击方式"><a href="#中间人攻击方式" class="header-anchor">#</a> 中间人攻击方式</h3> <div class="language-plantuml extra-class"><pre class="language-plantuml"><code><span class="token delimiter punctuation">@startuml</span>
<span class="token keyword">title</span> HTTPS中间人攻击<span class="token punctuation">(</span>抓包<span class="token punctuation">)</span>流程

<span class="token keyword">participant</span> 客户端
<span class="token keyword">participant</span> 中间人 <span class="token keyword">as</span> <span class="token string">&quot;抓包工具\n(中间人)&quot;</span>
<span class="token keyword">participant</span> 服务器

客户端 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> ClientHello <span class="token punctuation">(</span>原本发往服务器<span class="token punctuation">)</span>
中间人 <span class="token arrow operator">-&gt;</span> 服务器<span class="token punctuation">:</span> 转发ClientHello
服务器 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> ServerHello + 服务器证书
中间人 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> 生成伪造证书\n<span class="token punctuation">(</span>使用自己的CA签名<span class="token punctuation">)</span>
中间人 <span class="token arrow operator">-&gt;</span> 客户端<span class="token punctuation">:</span> 返回伪造证书
客户端 <span class="token arrow operator">-&gt;</span> 客户端<span class="token punctuation">:</span> 验证证书\n<span class="token punctuation">(</span>如果信任中间人CA则通过<span class="token punctuation">)</span>

客户端 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> 预主密钥<span class="token punctuation">(</span>用中间人公钥加密<span class="token punctuation">)</span>
中间人 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> 用私钥解密预主密钥
中间人 <span class="token arrow operator">-&gt;</span> 服务器<span class="token punctuation">:</span> 预主密钥<span class="token punctuation">(</span>用服务器公钥加密<span class="token punctuation">)</span>
服务器 <span class="token arrow operator">-&gt;</span> 服务器<span class="token punctuation">:</span> 用私钥解密预主密钥

客户端 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> 加密的应用数据
中间人 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> 解密并记录数据
中间人 <span class="token arrow operator">-&gt;</span> 服务器<span class="token punctuation">:</span> 重新加密并转发
服务器 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> 加密的响应数据
中间人 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> 解密并记录数据
中间人 <span class="token arrow operator">-&gt;</span> 客户端<span class="token punctuation">:</span> 重新加密并转发

<span class="token keyword">note</span> over 中间人<span class="token punctuation">:</span> 中间人同时维护两个独立的TLS连接<span class="token punctuation">:</span>\n1. 客户端 ↔ 中间人\n2. 中间人 ↔ 服务器\n并能够解密和查看所有流量
<span class="token delimiter punctuation">@enduml</span>
</code></pre></div><h3 id="android-安全升级时间线"><a href="#android-安全升级时间线" class="header-anchor">#</a> Android 安全升级时间线</h3> <p>Android 6.0：开始区分系统证书和用户证书</p> <p>Android 7.0+：默认不信任用户安装的 CA 证书</p> <p>Android 10+：进一步限制，特别是针对 targetSdkVersion 高的应用</p> <p>Android 14：强化限制，用户证书更难被应用信任</p> <h3 id="ssl-pinning-证书固定"><a href="#ssl-pinning-证书固定" class="header-anchor">#</a> SSL Pinning（证书固定）</h3> <p>SSL Pinning 是一种安全机制，应用程序只信任特定的证书或公钥，而不是整个系统的证书链。</p> <div class="language-plantuml extra-class"><pre class="language-plantuml"><code><span class="token delimiter punctuation">@startuml</span>
<span class="token keyword">title</span> SSL Pinning保护机制

<span class="token keyword">participant</span> 客户端 <span class="token keyword">as</span> <span class="token string">&quot;客户端APP\n(启用SSL Pinning)&quot;</span>
<span class="token keyword">participant</span> 中间人 <span class="token keyword">as</span> <span class="token string">&quot;抓包工具\n(中间人)&quot;</span>
<span class="token keyword">participant</span> 服务器

客户端 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> ClientHello
中间人 <span class="token arrow operator">-&gt;</span> 服务器<span class="token punctuation">:</span> 转发ClientHello
服务器 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> ServerHello + 服务器证书
中间人 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> 生成伪造证书
中间人 <span class="token arrow operator">-&gt;</span> 客户端<span class="token punctuation">:</span> 返回伪造证书

客户端 <span class="token arrow operator">-&gt;</span> 客户端<span class="token punctuation">:</span> 验证证书\n与内置的预期证书对比
客户端 <span class="token arrow operator">-&gt;</span> 客户端<span class="token punctuation">:</span> 发现证书不匹配!\n拒绝连接

客户端 <span class="token arrow operator">-&gt;</span> 中间人<span class="token punctuation">:</span> 终止连接\n<span class="token punctuation">(</span>证书验证错误<span class="token punctuation">)</span>
<span class="token keyword">note</span> right of 客户端<span class="token punctuation">:</span> SSL Pinning阻止了中间人攻击\n因为APP只信任特定的证书
<span class="token delimiter punctuation">@enduml</span>
</code></pre></div><h4 id="ssl-pinning-的两种形式"><a href="#ssl-pinning-的两种形式" class="header-anchor">#</a> SSL Pinning 的两种形式</h4> <ul><li>证书固定：直接固定具体的证书文件
<ul><li>缺点: 证书都是有有效期的,证书失效前需更新客户端中的证书</li></ul></li> <li>公钥固定：固定证书中的公钥（更灵活）</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/network/http.html" class="prev">
        图解 HTTP 笔记
      </a></span> <span class="next"><a href="/network/iptv.html">
        IPTV
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.52c91322.js" defer></script><script src="/assets/js/2.163e2f28.js" defer></script><script src="/assets/js/1.f9594dd0.js" defer></script><script src="/assets/js/72.9c48fd21.js" defer></script>
  </body>
</html>
