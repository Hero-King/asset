<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>openwrt | HeroKing的个人笔记</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link href="https://cdn.bootcdn.net/ajax/libs/normalize/8.0.1/normalize.min.css" rel="stylesheet">
    <script src="https://hm.baidu.com/hm.js?3691b93bb6fcef0775ef18a936452b97" defer="true"></script>
    <meta name="description" content="学习犹如逆水行舟,不进则退">
    
    <link rel="preload" href="/assets/css/0.styles.51c3fc7f.css" as="style"><link rel="preload" href="/assets/js/app.52c91322.js" as="script"><link rel="preload" href="/assets/js/2.163e2f28.js" as="script"><link rel="preload" href="/assets/js/1.f9594dd0.js" as="script"><link rel="preload" href="/assets/js/75.5dc05441.js" as="script"><link rel="prefetch" href="/assets/js/10.179e31cc.js"><link rel="prefetch" href="/assets/js/100.a2da16f1.js"><link rel="prefetch" href="/assets/js/11.0e411808.js"><link rel="prefetch" href="/assets/js/12.947f28db.js"><link rel="prefetch" href="/assets/js/13.14b6263c.js"><link rel="prefetch" href="/assets/js/14.d0c47c93.js"><link rel="prefetch" href="/assets/js/15.148f04fa.js"><link rel="prefetch" href="/assets/js/16.e6f33590.js"><link rel="prefetch" href="/assets/js/17.ab2d7eb1.js"><link rel="prefetch" href="/assets/js/18.5d8b1599.js"><link rel="prefetch" href="/assets/js/19.24ad168e.js"><link rel="prefetch" href="/assets/js/20.41a6a709.js"><link rel="prefetch" href="/assets/js/21.8218c0fb.js"><link rel="prefetch" href="/assets/js/22.603a3453.js"><link rel="prefetch" href="/assets/js/23.f4004600.js"><link rel="prefetch" href="/assets/js/24.d0446a23.js"><link rel="prefetch" href="/assets/js/25.4015af20.js"><link rel="prefetch" href="/assets/js/26.95e367fb.js"><link rel="prefetch" href="/assets/js/27.b7140a23.js"><link rel="prefetch" href="/assets/js/28.03cb7016.js"><link rel="prefetch" href="/assets/js/29.f939fbc6.js"><link rel="prefetch" href="/assets/js/3.678789c9.js"><link rel="prefetch" href="/assets/js/30.a760633a.js"><link rel="prefetch" href="/assets/js/31.3f298ff5.js"><link rel="prefetch" href="/assets/js/32.6cdbe59a.js"><link rel="prefetch" href="/assets/js/33.cbd36427.js"><link rel="prefetch" href="/assets/js/34.6230043f.js"><link rel="prefetch" href="/assets/js/35.ef5c8a34.js"><link rel="prefetch" href="/assets/js/36.5be64e88.js"><link rel="prefetch" href="/assets/js/37.dfc3b440.js"><link rel="prefetch" href="/assets/js/38.6a04c56e.js"><link rel="prefetch" href="/assets/js/39.c3f3a91b.js"><link rel="prefetch" href="/assets/js/4.30e44ed7.js"><link rel="prefetch" href="/assets/js/40.cda9d865.js"><link rel="prefetch" href="/assets/js/41.4a21d8ec.js"><link rel="prefetch" href="/assets/js/42.875b2f31.js"><link rel="prefetch" href="/assets/js/43.dcf673ca.js"><link rel="prefetch" href="/assets/js/44.b08ecd05.js"><link rel="prefetch" href="/assets/js/45.0fef276e.js"><link rel="prefetch" href="/assets/js/46.08975b0f.js"><link rel="prefetch" href="/assets/js/47.a8a0d0e8.js"><link rel="prefetch" href="/assets/js/48.484656ac.js"><link rel="prefetch" href="/assets/js/49.7d93d7fe.js"><link rel="prefetch" href="/assets/js/5.6beae35f.js"><link rel="prefetch" href="/assets/js/50.51c8b216.js"><link rel="prefetch" href="/assets/js/51.f973567d.js"><link rel="prefetch" href="/assets/js/52.6501423b.js"><link rel="prefetch" href="/assets/js/53.ba00f3d2.js"><link rel="prefetch" href="/assets/js/54.161545a4.js"><link rel="prefetch" href="/assets/js/55.70dea2a8.js"><link rel="prefetch" href="/assets/js/56.5c3c6b6c.js"><link rel="prefetch" href="/assets/js/57.8c781bf8.js"><link rel="prefetch" href="/assets/js/58.ce6d2f78.js"><link rel="prefetch" href="/assets/js/59.54658a12.js"><link rel="prefetch" href="/assets/js/6.e78facd0.js"><link rel="prefetch" href="/assets/js/60.67d6e287.js"><link rel="prefetch" href="/assets/js/61.4183ad7c.js"><link rel="prefetch" href="/assets/js/62.0024316d.js"><link rel="prefetch" href="/assets/js/63.105d731b.js"><link rel="prefetch" href="/assets/js/64.2b24cf92.js"><link rel="prefetch" href="/assets/js/65.90c5c7d1.js"><link rel="prefetch" href="/assets/js/66.e984a9e5.js"><link rel="prefetch" href="/assets/js/67.87930007.js"><link rel="prefetch" href="/assets/js/68.3426008a.js"><link rel="prefetch" href="/assets/js/69.f13b68e6.js"><link rel="prefetch" href="/assets/js/7.c3aab524.js"><link rel="prefetch" href="/assets/js/70.69f21f98.js"><link rel="prefetch" href="/assets/js/71.67a72bf5.js"><link rel="prefetch" href="/assets/js/72.9c48fd21.js"><link rel="prefetch" href="/assets/js/73.6e5611f9.js"><link rel="prefetch" href="/assets/js/74.52d0441e.js"><link rel="prefetch" href="/assets/js/76.cd45adcb.js"><link rel="prefetch" href="/assets/js/77.f953fc79.js"><link rel="prefetch" href="/assets/js/78.e9caab6e.js"><link rel="prefetch" href="/assets/js/79.8b7301be.js"><link rel="prefetch" href="/assets/js/80.0df4d93a.js"><link rel="prefetch" href="/assets/js/81.b54281ce.js"><link rel="prefetch" href="/assets/js/82.2a223009.js"><link rel="prefetch" href="/assets/js/83.4dc9bdbf.js"><link rel="prefetch" href="/assets/js/84.d77a6784.js"><link rel="prefetch" href="/assets/js/85.75e7aba3.js"><link rel="prefetch" href="/assets/js/86.b9ec5bce.js"><link rel="prefetch" href="/assets/js/87.adb5d482.js"><link rel="prefetch" href="/assets/js/88.86bcee6d.js"><link rel="prefetch" href="/assets/js/89.350d0fb3.js"><link rel="prefetch" href="/assets/js/90.d5bf7676.js"><link rel="prefetch" href="/assets/js/91.cb157e9e.js"><link rel="prefetch" href="/assets/js/92.7c2880c4.js"><link rel="prefetch" href="/assets/js/93.b365d13c.js"><link rel="prefetch" href="/assets/js/94.39a9943c.js"><link rel="prefetch" href="/assets/js/95.c4919abd.js"><link rel="prefetch" href="/assets/js/96.1f3f53d2.js"><link rel="prefetch" href="/assets/js/97.e66f15bb.js"><link rel="prefetch" href="/assets/js/98.20e46b04.js"><link rel="prefetch" href="/assets/js/99.7383c9a9.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.2f354cfa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.51c3fc7f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HeroKing的个人笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="afterEnd" class="dropdown-title"><span class="title">afterEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="afterEnd" class="mobile-dropdown-title"><span class="title">afterEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/afterEnd/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/JMS/" class="nav-link">
  JMS
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/" class="nav-link">
  After End
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="algorithms" class="dropdown-title"><span class="title">algorithms</span> <span class="arrow down"></span></button> <button type="button" aria-label="algorithms" class="mobile-dropdown-title"><span class="title">algorithms</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithms/" class="nav-link">
  Algorithms
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="frontEnd" class="dropdown-title"><span class="title">frontEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="frontEnd" class="mobile-dropdown-title"><span class="title">frontEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/autojs/" class="nav-link">
  Autojs
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/css/" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/demo/" class="nav-link">
  Demo
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link">
  Front End
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/ts/" class="nav-link">
  Ts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="life" class="dropdown-title"><span class="title">life</span> <span class="arrow down"></span></button> <button type="button" aria-label="life" class="mobile-dropdown-title"><span class="title">life</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/life/" class="nav-link">
  Life
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="network" class="dropdown-title"><span class="title">network</span> <span class="arrow down"></span></button> <button type="button" aria-label="network" class="mobile-dropdown-title"><span class="title">network</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link router-link-active">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/network/proxy/" class="nav-link">
  Proxy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="software" class="dropdown-title"><span class="title">software</span> <span class="arrow down"></span></button> <button type="button" aria-label="software" class="mobile-dropdown-title"><span class="title">software</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/software/ftp/" class="nav-link">
  Ftp
</a></li><li class="dropdown-item"><!----> <a href="/software/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/software/samba/" class="nav-link">
  Samba
</a></li><li class="dropdown-item"><!----> <a href="/software/" class="nav-link">
  Software
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="system" class="dropdown-title"><span class="title">system</span> <span class="arrow down"></span></button> <button type="button" aria-label="system" class="mobile-dropdown-title"><span class="title">system</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/system/Hackintosh/" class="nav-link">
  Hackintosh
</a></li><li class="dropdown-item"><!----> <a href="/system/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/system/" class="nav-link">
  System
</a></li><li class="dropdown-item"><!----> <a href="/system/windows/" class="nav-link">
  Windows
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="afterEnd" class="dropdown-title"><span class="title">afterEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="afterEnd" class="mobile-dropdown-title"><span class="title">afterEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/afterEnd/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/JMS/" class="nav-link">
  JMS
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/" class="nav-link">
  After End
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="algorithms" class="dropdown-title"><span class="title">algorithms</span> <span class="arrow down"></span></button> <button type="button" aria-label="algorithms" class="mobile-dropdown-title"><span class="title">algorithms</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithms/" class="nav-link">
  Algorithms
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="frontEnd" class="dropdown-title"><span class="title">frontEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="frontEnd" class="mobile-dropdown-title"><span class="title">frontEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/autojs/" class="nav-link">
  Autojs
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/css/" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/demo/" class="nav-link">
  Demo
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link">
  Front End
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/ts/" class="nav-link">
  Ts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="life" class="dropdown-title"><span class="title">life</span> <span class="arrow down"></span></button> <button type="button" aria-label="life" class="mobile-dropdown-title"><span class="title">life</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/life/" class="nav-link">
  Life
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="network" class="dropdown-title"><span class="title">network</span> <span class="arrow down"></span></button> <button type="button" aria-label="network" class="mobile-dropdown-title"><span class="title">network</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link router-link-active">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/network/proxy/" class="nav-link">
  Proxy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="software" class="dropdown-title"><span class="title">software</span> <span class="arrow down"></span></button> <button type="button" aria-label="software" class="mobile-dropdown-title"><span class="title">software</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/software/ftp/" class="nav-link">
  Ftp
</a></li><li class="dropdown-item"><!----> <a href="/software/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/software/samba/" class="nav-link">
  Samba
</a></li><li class="dropdown-item"><!----> <a href="/software/" class="nav-link">
  Software
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="system" class="dropdown-title"><span class="title">system</span> <span class="arrow down"></span></button> <button type="button" aria-label="system" class="mobile-dropdown-title"><span class="title">system</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/system/Hackintosh/" class="nav-link">
  Hackintosh
</a></li><li class="dropdown-item"><!----> <a href="/system/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/system/" class="nav-link">
  System
</a></li><li class="dropdown-item"><!----> <a href="/system/windows/" class="nav-link">
  Windows
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Network</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/network/" aria-current="page" class="sidebar-link">网络</a></li><li><a href="/network/DDNS.html" class="sidebar-link">DDNS</a></li><li><a href="/network/home.html" class="sidebar-link">家庭网络中客厅到弱电箱只有一根网线怎么办?单臂路由?还是...</a></li><li><a href="/network/http.html" class="sidebar-link">图解 HTTP 笔记</a></li><li><a href="/network/https.html" class="sidebar-link">Https 权威指南</a></li><li><a href="/network/iptv.html" class="sidebar-link">IPTV</a></li><li><a href="/network/modem.html" class="sidebar-link">光猫</a></li><li><a href="/network/openwrt.html" aria-current="page" class="active sidebar-link">openwrt</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/openwrt.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/network/openwrt.html#资料" class="sidebar-link">资料</a></li><li class="sidebar-sub-header"><a href="/network/openwrt.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/network/openwrt.html#插件" class="sidebar-link">插件</a></li><li class="sidebar-sub-header"><a href="/network/openwrt.html#配置" class="sidebar-link">配置</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="openwrt"><a href="#openwrt" class="header-anchor">#</a> openwrt</h1> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <p>luci op 的页面, 如果需要使用页面管理插件, 需要安装 luci-app-*的包
opkg op 的软件包管理程序, opkg install; list ;
uci op 的配置文件配置器</p> <h2 id="资料"><a href="#资料" class="header-anchor">#</a> 资料</h2> <p>野火 OpenWrt 用户手册 ： https://doc.embedfire.com/openwrt/user_manal/zh/latest/index.html</p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p>后续使用 openwrt.ai 生成</p> <p>按照品牌搜索下载对应的 sysupdate.bin 包
pve 安装 <code>qm importdisk 100 /var/lib/vz/template/iso/xx.img local --format qcow2</code> ; (100 是 VMid) 然后磁盘添加; 设置硬盘启动; 启动后修改密码; ip: 192.168.2.1 修改 ip <code>vi /etc/config/network</code></p> <p>ipv6 可能需要 21.02.3 版本</p> <h2 id="插件"><a href="#插件" class="header-anchor">#</a> 插件</h2> <ul><li>首页改用 nginx</li> <li>去掉科学上网;dns 过滤; arpbind; cifs-mount; cpulimit; filebrowser; eqos; easymesh; ;</li> <li>adbyby 广告屏蔽</li> <li>网络存储都要 aria2 nfs ftp Samba4 Transmission</li> <li>vpn 都要 v2ray; openvpn; IPSec VPN; PPTP VPN 服务器</li> <li>阿里云盘 FUSE</li> <li>阿里云盘 WebDAV</li> <li>ddns; frps; kms</li> <li>BearDropper (公网 ssh 防御)</li> <li>ServerChan (微信推送)</li> <li>nlbw 宽带监控</li> <li>accesscontrol 访问时间控制</li> <li>abdlock ABD 广告过滤</li> <li>amule amule 下载工具</li> <li>dockerman docker 执行 /etc/init.d/dockerd 管理docker 设置开启启动: ln -s /etc/init.d/dockerd /etc/rc.d/S100docker</li> <li>kodexplorer 可道云（像 windows 一样管理文件）</li> <li>AdGuard Home 去广告插件(原理 dns 劫持)</li> <li>openclash 代理</li></ul> <h3 id="常用的包"><a href="#常用的包" class="header-anchor">#</a> 常用的包</h3> <ul><li>ttyd web shell</li> <li>v2ray-server</li> <li>netdata (性能检测) <code>cd /usr/share/netdata/web chown -R root:root *</code></li> <li>acme 自动化 ssl 证书管理</li> <li>aria2 下载工具</li> <li>arpbind ip/mac 绑定</li> <li>autoreboot 计划重启</li> <li>ddns 各种厂商的 ddns 服务</li> <li>frps frp 服务端 看情况安装</li> <li>samba4</li> <li>smartdns dns 服务器</li> <li>vsftp</li> <li>nginx-manager</li> <li>diskman 磁盘管理</li> <li>wechatpush 微信推送</li> <li>wolplus</li> <li>turboacc 网络加速</li> <li>alist 多网站网盘文件列表</li> <li>zerotier 零盾 异地组网 内网穿透 vpn</li></ul> <h2 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h2> <h3 id="smartdns"><a href="#smartdns" class="header-anchor">#</a> smartdns</h3> <div class="language-text extra-class"><pre class="language-text"><code>cname /blog.heroking.top/hero-king.github.io
cname /pan.heroking.top/hero-king.github.io
cname /nav.heroking.top/hero-king.github.io
address /heroking.top/192.168.2.4
</code></pre></div><h3 id="passwall"><a href="#passwall" class="header-anchor">#</a> Passwall</h3> <p>DNS 注意选择DOH;打开FakeDns</p> <blockquote><p>https://nanodesu.net/archives/36/
https://www.right.com.cn/forum/thread-8325875-1-1.html</p></blockquote> <h4 id="根据订阅url查询流量信息"><a href="#根据订阅url查询流量信息" class="header-anchor">#</a> 根据订阅URL查询流量信息</h4> <p>取响应头中的 subscription-userinfo</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">curl</span> <span class="token parameter variable">-sLI</span> <span class="token parameter variable">-X</span> GET <span class="token parameter variable">-m</span> <span class="token number">10</span> <span class="token parameter variable">-w</span> <span class="token string">'http_code=%{http_code}'</span> <span class="token parameter variable">-H</span> <span class="token string">'User-Agent: Clash'</span> 订阅URL
</code></pre></div><h4 id="pac"><a href="#pac" class="header-anchor">#</a> PAC</h4> <p>个人socks服务器放到公网</p> <ul><li>nginx对外分享PAC文件，新建auth目录中存放需要鉴权的内容，使用 query_string进行判断是否403<div class="language- extra-class"><pre class="language-text"><code>location /auth/ {
  root /web;
  if ($query_string !~* &quot;aa=bb&quot;) {  
    return 403;
  }
}
</code></pre></div></li> <li>每日动态更新socks服务器对外暴露的端口和PAC文件中socks端口</li></ul> <h4 id="只想特定机器走代理"><a href="#只想特定机器走代理" class="header-anchor">#</a> 只想特定机器走代理?</h4> <p>可以使用 passwall 的 socks 代理服务器, 在基本设置中=&gt;socks 设置, 直接配置一个 socks 服务器, 在 Windows/Mac 中使用即可</p> <h3 id="openclash"><a href="#openclash" class="header-anchor">#</a> openclash</h3> <p>上手</p> <ol><li>配置订阅中添加订阅地址，使用在线订阅地址转换处理各种路由规则</li></ol> <ul><li>使用<a href="https://raw.githubusercontent.com/Aethersailor/Custom_OpenClash_Rules/main/cfg/Custom_Clash.ini" target="_blank" rel="noopener noreferrer">自定义模板<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>转换 分组特别细致,可解决2痛点问题</li></ul> <ol start="2"><li>由于chatgpt对香港地区不提供服务，需要走国外节点，覆写设置-规则设置-自定义规则中指定chatgpt路由</li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> DOMAIN<span class="token punctuation">-</span>SUFFIX<span class="token punctuation">,</span>openai.com<span class="token punctuation">,</span><span class="token punctuation">[</span>ss<span class="token punctuation">]</span>新加坡
<span class="token punctuation">-</span> DOMAIN<span class="token punctuation">-</span>SUFFIX<span class="token punctuation">,</span>chatgpt.com<span class="token punctuation">,</span><span class="token punctuation">[</span>ss<span class="token punctuation">]</span>新加坡
</code></pre></div><h3 id="uhttpd"><a href="#uhttpd" class="header-anchor">#</a> uhttpd</h3> <p>配置 https 则配置 <code>/etc/config/uhttpd</code>文件(https://openwrt.org/docs/guide-user/services/webserver/uhttpd)
或者使用 luci(页面)配置 (配置了 ssl 证书需要其他端口转发到 443 同时需要使用 https 协议访问)</p> <div class="language-shell extra-class"><pre class="language-shell"><code>uci show uhttpd.main
<span class="token assign-left variable">uhttpd.main</span><span class="token operator">=</span>uhttpd
<span class="token assign-left variable">uhttpd.main.listen_http</span><span class="token operator">=</span><span class="token string">'0.0.0.0:80'</span>
<span class="token assign-left variable">uhttpd.main.listen_https</span><span class="token operator">=</span><span class="token string">'0.0.0.0:443'</span>
<span class="token assign-left variable">uhttpd.nain.tcp_keepalive</span><span class="token operator">=</span><span class="token string">'1'</span>
<span class="token assign-left variable">uhttpd.main.rfc1918_filter</span><span class="token operator">=</span><span class="token string">'0'</span>
<span class="token assign-left variable">uhttpd.main.key</span><span class="token operator">=</span><span class="token string">'/etc/luci-uploads/cbid.uhttpd.main.key'</span>
<span class="token assign-left variable">uhttpd.main.cert</span><span class="token operator">=</span><span class="token string">'/etc/luci-uploads/cbid.uhttpd.main.cert'</span>
<span class="token assign-left variable">uhttpd.main.redirect_https</span><span class="token operator">=</span><span class="token string">'1'</span>  <span class="token comment"># 或者0 在内网无所谓</span>
</code></pre></div><ul><li>acme 泛域名证书申请 : https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E</li> <li>系统-启动项-appfilter 关闭自启动</li></ul> <h3 id="nginx"><a href="#nginx" class="header-anchor">#</a> nginx</h3> <h4 id="查看-nginx-初始配置"><a href="#查看-nginx-初始配置" class="header-anchor">#</a> 查看 nginx 初始配置</h4> <p>https://blog.csdn.net/m0_46645810/article/details/129034751</p> <p>设置了 root 目录 restrict_locally 是内网主机, 也就是默认配置做了 80 =&gt; 443 然后只允许内网的一个 web 服务器, ssl 证书是 openwrt 自带的</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cat</span> /etc/nginx/uci.conf

root/www<span class="token punctuation">;</span>
server <span class="token punctuation">{</span> <span class="token comment">#see uci show 'nginx._lan'</span>
    listen <span class="token number">443</span> ssl default_seruer<span class="token punctuation">;</span>
    listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:443 ssl default_seruer<span class="token punctuation">;</span>
    seruer_name _lan<span class="token punctuation">;</span>
    include restrict_locally<span class="token punctuation">;</span>
    include conf.d/*.locations<span class="token punctuation">;</span>
    ssl_certificate /etc/nginx/conf.d/_lan.crt<span class="token punctuation">;</span>
    ssl_certificate_key/etc/nginx/conf.d/_lan.key<span class="token punctuation">;</span>
    ssl_session_cache shared:SSL:32k<span class="token punctuation">;</span>
    ssl_session_timeout 64m<span class="token punctuation">;</span>
    access_log off<span class="token punctuation">;</span> <span class="token comment">#t logd openurt;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span> <span class="token comment">#see uci shou 'nginx. redirect2ssl'</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80<span class="token punctuation">;</span>
    seruer_name _redirect2ssl<span class="token punctuation">;</span>
    <span class="token builtin class-name">return</span> <span class="token number">302</span> https://Shost<span class="token variable">$request_uri</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
include conf.d/*.conf<span class="token punctuation">;</span>
</code></pre></div><h4 id="自行设置-nginx"><a href="#自行设置-nginx" class="header-anchor">#</a> 自行设置 nginx</h4> <ol><li>取消 uci 接管 nginx [可选]<div class="language-shell extra-class"><pre class="language-shell"><code> uci <span class="token builtin class-name">set</span> <span class="token assign-left variable">nginx.global.uci_enable</span><span class="token operator">=</span>false
 uci commit nginx
</code></pre></div></li> <li>修改/etc/nginx/nginx.conf 文件或者 uci.conf [可选]</li> <li>在/etc/nginx/conf.d/下新建配置文件, 监听其他端口, 防火墙开放, 使用 nginx 转发内网 web 服务</li></ol> <h3 id="ssl-acme"><a href="#ssl-acme" class="header-anchor">#</a> ssl-acme</h3> <p>acme 使用 : https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E</p> <p>页面配置: 常规设置域名先写主域名,其他域名,后写泛解析域名(*.域名) 验证方式<code>dns</code>;DnsAPI<code>dns_ali</code>; API 凭证列表: <code>Ali_Key=&quot;&lt;key&gt;&quot; Ali_Secret=&quot;&lt;secret&gt;&quot;</code>
软件库搜索 dnsapi 安装
执行 acme: <code>service acme start</code>, acme 安装在 /usr/lib/acme/client/acme.sh ,
ssl 证书目录 <code>/etc/acme/域名/域名.key和fullchain.cer</code>， 在 nginx 中配置即可</p> <h3 id="v2ray"><a href="#v2ray" class="header-anchor">#</a> v2ray</h3> <p>在 ui 中配置好，勾选允许访问内网</p> <h4 id="vmess协议-配合nginx一起使用"><a href="#vmess协议-配合nginx一起使用" class="header-anchor">#</a> Vmess协议, 配合NGINX一起使用</h4> <img src="/img/proxy/openwrt_v2ray_server_config.png"> <h3 id="minidlna"><a href="#minidlna" class="header-anchor">#</a> minidlna</h3> <p>家庭流媒体， 只需要调整下媒体目录，启用即可 后台监控可以访问网关:8200</p> <h3 id="beardropper"><a href="#beardropper" class="header-anchor">#</a> BearDropper</h3> <p>安装 luci-app-BearDropper</p> <h3 id="alist"><a href="#alist" class="header-anchor">#</a> alist</h3> <p>配置好端口, 如果需要外网访问需要防火墙放行, 启用 ssl, 数据目录不调整, 缓存目录默认<code>/tmp/alist</code>, 如果需要离线下载大文件, 调整此目录到新的磁盘分区中</p> <h3 id="netdata"><a href="#netdata" class="header-anchor">#</a> netdata</h3> <p>默认不支持 https</p> <p>修改<code>/usr/lib/lua/luci/view/netdata.htm</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'heroking.top'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'netdata'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'https://'</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname <span class="token operator">+</span> <span class="token string">':8000/netdata/'</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'netdata'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://'</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname <span class="token operator">+</span> <span class="token string">':19999'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用 nginx 代理网页</p> <div class="language-shell extra-class"><pre class="language-shell"><code>
server <span class="token punctuation">{</span>
  listen <span class="token number">8000</span><span class="token punctuation">;</span>
  listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:8000<span class="token punctuation">;</span>
  server_name op.heroking.top<span class="token punctuation">;</span>
  location / <span class="token punctuation">{</span>
    proxy_pass https://192.168.2.1<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  location ^~ /netdata/ <span class="token punctuation">{</span>
     proxy_pass http://127.0.0.1:19999/<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="上网"><a href="#上网" class="header-anchor">#</a> 上网</h3> <h4 id="单臂路由"><a href="#单臂路由" class="header-anchor">#</a> 单臂路由</h4> <p>https://www.right.com.cn/forum/thread-5768047-1-1.html
https://www.right.com.cn/FORUM/thread-6196997-1-1.html</p> <p>光猫不设置 vlan 也可以</p> <div class="language-shell extra-class"><pre class="language-shell"><code>config interface <span class="token string">'loopback'</span>
        option device <span class="token string">'lo'</span>
        option proto <span class="token string">'static'</span>
        option ipaddr <span class="token string">'127.0.0.1'</span>
        option netmask <span class="token string">'255.0.0.0'</span>

config globals <span class="token string">'globals'</span>
        option ula_prefix <span class="token string">'fdf6:076a:018b::/48'</span>
        option packet_steering <span class="token string">'1'</span>

config device
        option name <span class="token string">'br-lan'</span>
        option <span class="token builtin class-name">type</span> <span class="token string">'bridge'</span>
        list ports <span class="token string">'eth0'</span>
        option promisc <span class="token string">'1'</span>

config interface <span class="token string">'lan'</span>
        option device <span class="token string">'eth0'</span>
        option proto <span class="token string">'static'</span>
        option ipaddr <span class="token string">'192.168.2.1'</span>
        option netmask <span class="token string">'255.255.255.0'</span>
        option ip6assign <span class="token string">'60'</span>

config interface <span class="token string">'wan'</span>
        option proto <span class="token string">'pppoe'</span>
        option username <span class="token string">'xxx'</span>
        option password <span class="token string">'xxx'</span>
        option device <span class="token string">'eth0'</span>
        option ipv6 <span class="token string">'auto'</span>

</code></pre></div><h4 id="旁路由设置"><a href="#旁路由设置" class="header-anchor">#</a> 旁路由设置</h4> <ol><li>使用设置向导, 初始化成旁路有模式</li> <li>设置DHCP服务器，将设备Mac地址与IP绑定</li> <li>lan接口中设置DHCP分配的IP范围为100~140; 设置强制, 动态DHCP用来给绑定好ip的设备下发网关和DNS;</li> <li>防火墙设置Lan口动态伪装(将经过网关的报文源ip地址修改为网关ip, 使得相应报文经主路由回复给网关而不是其他内网ip) 或者使用自定义规则<code>iptables -t nat -I POSTROUTING -o eth0 -j MASQUERADE</code> 即可</li> <li>暴露在公网中的旁路有还需要设置下述内容</li> <li>防火墙自定义规则(允许内网设备访问op, 放行常用服务端口)</li></ol> <div class="language- extra-class"><pre class="language-text"><code># 允许内网 IP 访问（192.168.0.0/16 网段）
iptables -A INPUT -s 192.168.0.0/16 -j ACCEPT

# 允许内网 IP 访问（10.0.0.0/8 网段）
iptables -A INPUT -s 10.0.0.0/8 -j ACCEPT

# 允许内网 IP 访问（172.16.0.0/12 网段）
iptables -A INPUT -s 172.16.0.0/12 -j ACCEPT
# 范围端口使用:相连接
iptables  -A  INPUT -p tcp  -m  multiport --dports  80,443,8000,9000:10000  -j  ACCEPT
</code></pre></div><ol start="6"><li>禁用外网访问: 防火墙-区域-lan-&gt;wan入站数据设置为拒绝</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/network/modem.html" class="prev">
        光猫
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.52c91322.js" defer></script><script src="/assets/js/2.163e2f28.js" defer></script><script src="/assets/js/1.f9594dd0.js" defer></script><script src="/assets/js/75.5dc05441.js" defer></script>
  </body>
</html>
