<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>家庭网络中客厅到弱电箱只有一根网线怎么办?单臂路由?还是... | HeroKing的个人笔记</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link href="https://cdn.bootcdn.net/ajax/libs/normalize/8.0.1/normalize.min.css" rel="stylesheet">
    <script src="https://hm.baidu.com/hm.js?3691b93bb6fcef0775ef18a936452b97" defer="true"></script>
    <meta name="description" content="学习犹如逆水行舟,不进则退">
    
    <link rel="preload" href="/assets/css/0.styles.51c3fc7f.css" as="style"><link rel="preload" href="/assets/js/app.f6a8c955.js" as="script"><link rel="preload" href="/assets/js/2.163e2f28.js" as="script"><link rel="preload" href="/assets/js/1.f9594dd0.js" as="script"><link rel="preload" href="/assets/js/70.69f21f98.js" as="script"><link rel="prefetch" href="/assets/js/10.da97ed6b.js"><link rel="prefetch" href="/assets/js/100.a231b992.js"><link rel="prefetch" href="/assets/js/101.6d35d549.js"><link rel="prefetch" href="/assets/js/11.0e411808.js"><link rel="prefetch" href="/assets/js/12.947f28db.js"><link rel="prefetch" href="/assets/js/13.14b6263c.js"><link rel="prefetch" href="/assets/js/14.d0c47c93.js"><link rel="prefetch" href="/assets/js/15.148f04fa.js"><link rel="prefetch" href="/assets/js/16.e6f33590.js"><link rel="prefetch" href="/assets/js/17.ab2d7eb1.js"><link rel="prefetch" href="/assets/js/18.5d8b1599.js"><link rel="prefetch" href="/assets/js/19.24ad168e.js"><link rel="prefetch" href="/assets/js/20.853e8cab.js"><link rel="prefetch" href="/assets/js/21.8218c0fb.js"><link rel="prefetch" href="/assets/js/22.603a3453.js"><link rel="prefetch" href="/assets/js/23.f4004600.js"><link rel="prefetch" href="/assets/js/24.22310276.js"><link rel="prefetch" href="/assets/js/25.cb21eece.js"><link rel="prefetch" href="/assets/js/26.c54da579.js"><link rel="prefetch" href="/assets/js/27.f57556cf.js"><link rel="prefetch" href="/assets/js/28.2649c5b6.js"><link rel="prefetch" href="/assets/js/29.f939fbc6.js"><link rel="prefetch" href="/assets/js/3.678789c9.js"><link rel="prefetch" href="/assets/js/30.5fd85372.js"><link rel="prefetch" href="/assets/js/31.df19fc4c.js"><link rel="prefetch" href="/assets/js/32.8bcbb2d6.js"><link rel="prefetch" href="/assets/js/33.cbd36427.js"><link rel="prefetch" href="/assets/js/34.6230043f.js"><link rel="prefetch" href="/assets/js/35.7c81472b.js"><link rel="prefetch" href="/assets/js/36.25210112.js"><link rel="prefetch" href="/assets/js/37.fd55f30a.js"><link rel="prefetch" href="/assets/js/38.59816109.js"><link rel="prefetch" href="/assets/js/39.2e72acbe.js"><link rel="prefetch" href="/assets/js/4.30e44ed7.js"><link rel="prefetch" href="/assets/js/40.df456fee.js"><link rel="prefetch" href="/assets/js/41.1d2a5b34.js"><link rel="prefetch" href="/assets/js/42.875b2f31.js"><link rel="prefetch" href="/assets/js/43.dcf673ca.js"><link rel="prefetch" href="/assets/js/44.b08ecd05.js"><link rel="prefetch" href="/assets/js/45.0fef276e.js"><link rel="prefetch" href="/assets/js/46.08975b0f.js"><link rel="prefetch" href="/assets/js/47.9d307bbb.js"><link rel="prefetch" href="/assets/js/48.4d62cb9d.js"><link rel="prefetch" href="/assets/js/49.6e97050f.js"><link rel="prefetch" href="/assets/js/5.6beae35f.js"><link rel="prefetch" href="/assets/js/50.9b9a3ad7.js"><link rel="prefetch" href="/assets/js/51.f973567d.js"><link rel="prefetch" href="/assets/js/52.6501423b.js"><link rel="prefetch" href="/assets/js/53.ba00f3d2.js"><link rel="prefetch" href="/assets/js/54.161545a4.js"><link rel="prefetch" href="/assets/js/55.3e7db058.js"><link rel="prefetch" href="/assets/js/56.c552d322.js"><link rel="prefetch" href="/assets/js/57.b71253b7.js"><link rel="prefetch" href="/assets/js/58.fcee000e.js"><link rel="prefetch" href="/assets/js/59.2afd7277.js"><link rel="prefetch" href="/assets/js/6.e78facd0.js"><link rel="prefetch" href="/assets/js/60.430c4bb8.js"><link rel="prefetch" href="/assets/js/61.244cd577.js"><link rel="prefetch" href="/assets/js/62.b8922694.js"><link rel="prefetch" href="/assets/js/63.5bf13672.js"><link rel="prefetch" href="/assets/js/64.dbef2543.js"><link rel="prefetch" href="/assets/js/65.90c5c7d1.js"><link rel="prefetch" href="/assets/js/66.aee6a0ba.js"><link rel="prefetch" href="/assets/js/67.5c20fecb.js"><link rel="prefetch" href="/assets/js/68.e8971efb.js"><link rel="prefetch" href="/assets/js/69.f13b68e6.js"><link rel="prefetch" href="/assets/js/7.c3aab524.js"><link rel="prefetch" href="/assets/js/71.2962f382.js"><link rel="prefetch" href="/assets/js/72.2992e47f.js"><link rel="prefetch" href="/assets/js/73.174ff7b4.js"><link rel="prefetch" href="/assets/js/74.51867acd.js"><link rel="prefetch" href="/assets/js/75.48b46c45.js"><link rel="prefetch" href="/assets/js/76.6d0de916.js"><link rel="prefetch" href="/assets/js/77.f953fc79.js"><link rel="prefetch" href="/assets/js/78.0d34bdce.js"><link rel="prefetch" href="/assets/js/79.8b7301be.js"><link rel="prefetch" href="/assets/js/80.2214c730.js"><link rel="prefetch" href="/assets/js/81.7c9e39e1.js"><link rel="prefetch" href="/assets/js/82.fc99cfa7.js"><link rel="prefetch" href="/assets/js/83.a1a65eec.js"><link rel="prefetch" href="/assets/js/84.be5a0a49.js"><link rel="prefetch" href="/assets/js/85.f17bfd83.js"><link rel="prefetch" href="/assets/js/86.db5d6c16.js"><link rel="prefetch" href="/assets/js/87.e10827d4.js"><link rel="prefetch" href="/assets/js/88.4bb2f2ae.js"><link rel="prefetch" href="/assets/js/89.d26b9b66.js"><link rel="prefetch" href="/assets/js/90.6daf5975.js"><link rel="prefetch" href="/assets/js/91.45ecdb37.js"><link rel="prefetch" href="/assets/js/92.f286e6b0.js"><link rel="prefetch" href="/assets/js/93.1f11519d.js"><link rel="prefetch" href="/assets/js/94.4ef1e3ce.js"><link rel="prefetch" href="/assets/js/95.3c07b4bf.js"><link rel="prefetch" href="/assets/js/96.1207c89f.js"><link rel="prefetch" href="/assets/js/97.fd8d86eb.js"><link rel="prefetch" href="/assets/js/98.60504ae0.js"><link rel="prefetch" href="/assets/js/99.30fd60ad.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.2f354cfa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.51c3fc7f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HeroKing的个人笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="afterEnd" class="dropdown-title"><span class="title">afterEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="afterEnd" class="mobile-dropdown-title"><span class="title">afterEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/afterEnd/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/JMS/" class="nav-link">
  JMS
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/" class="nav-link">
  After End
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="algorithms" class="dropdown-title"><span class="title">algorithms</span> <span class="arrow down"></span></button> <button type="button" aria-label="algorithms" class="mobile-dropdown-title"><span class="title">algorithms</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithms/" class="nav-link">
  Algorithms
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="frontEnd" class="dropdown-title"><span class="title">frontEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="frontEnd" class="mobile-dropdown-title"><span class="title">frontEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/autojs/" class="nav-link">
  Autojs
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/css/" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/demo/" class="nav-link">
  Demo
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link">
  Front End
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/ts/" class="nav-link">
  Ts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="life" class="dropdown-title"><span class="title">life</span> <span class="arrow down"></span></button> <button type="button" aria-label="life" class="mobile-dropdown-title"><span class="title">life</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/life/" class="nav-link">
  Life
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="network" class="dropdown-title"><span class="title">network</span> <span class="arrow down"></span></button> <button type="button" aria-label="network" class="mobile-dropdown-title"><span class="title">network</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link router-link-active">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/network/proxy/" class="nav-link">
  Proxy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="software" class="dropdown-title"><span class="title">software</span> <span class="arrow down"></span></button> <button type="button" aria-label="software" class="mobile-dropdown-title"><span class="title">software</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/software/ftp/" class="nav-link">
  Ftp
</a></li><li class="dropdown-item"><!----> <a href="/software/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/software/samba/" class="nav-link">
  Samba
</a></li><li class="dropdown-item"><!----> <a href="/software/" class="nav-link">
  Software
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="system" class="dropdown-title"><span class="title">system</span> <span class="arrow down"></span></button> <button type="button" aria-label="system" class="mobile-dropdown-title"><span class="title">system</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/system/Hackintosh/" class="nav-link">
  Hackintosh
</a></li><li class="dropdown-item"><!----> <a href="/system/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/system/" class="nav-link">
  System
</a></li><li class="dropdown-item"><!----> <a href="/system/windows/" class="nav-link">
  Windows
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="afterEnd" class="dropdown-title"><span class="title">afterEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="afterEnd" class="mobile-dropdown-title"><span class="title">afterEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/afterEnd/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/JMS/" class="nav-link">
  JMS
</a></li><li class="dropdown-item"><!----> <a href="/afterEnd/" class="nav-link">
  After End
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="algorithms" class="dropdown-title"><span class="title">algorithms</span> <span class="arrow down"></span></button> <button type="button" aria-label="algorithms" class="mobile-dropdown-title"><span class="title">algorithms</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithms/" class="nav-link">
  Algorithms
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="frontEnd" class="dropdown-title"><span class="title">frontEnd</span> <span class="arrow down"></span></button> <button type="button" aria-label="frontEnd" class="mobile-dropdown-title"><span class="title">frontEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/autojs/" class="nav-link">
  Autojs
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/css/" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/demo/" class="nav-link">
  Demo
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/express/" class="nav-link">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link">
  Front End
</a></li><li class="dropdown-item"><!----> <a href="/frontEnd/ts/" class="nav-link">
  Ts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="life" class="dropdown-title"><span class="title">life</span> <span class="arrow down"></span></button> <button type="button" aria-label="life" class="mobile-dropdown-title"><span class="title">life</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/life/" class="nav-link">
  Life
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="network" class="dropdown-title"><span class="title">network</span> <span class="arrow down"></span></button> <button type="button" aria-label="network" class="mobile-dropdown-title"><span class="title">network</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/" class="nav-link router-link-active">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/network/proxy/" class="nav-link">
  Proxy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="software" class="dropdown-title"><span class="title">software</span> <span class="arrow down"></span></button> <button type="button" aria-label="software" class="mobile-dropdown-title"><span class="title">software</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/software/ftp/" class="nav-link">
  Ftp
</a></li><li class="dropdown-item"><!----> <a href="/software/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/software/samba/" class="nav-link">
  Samba
</a></li><li class="dropdown-item"><!----> <a href="/software/" class="nav-link">
  Software
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="system" class="dropdown-title"><span class="title">system</span> <span class="arrow down"></span></button> <button type="button" aria-label="system" class="mobile-dropdown-title"><span class="title">system</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/system/Hackintosh/" class="nav-link">
  Hackintosh
</a></li><li class="dropdown-item"><!----> <a href="/system/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/system/" class="nav-link">
  System
</a></li><li class="dropdown-item"><!----> <a href="/system/windows/" class="nav-link">
  Windows
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Network</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/network/" aria-current="page" class="sidebar-link">网络</a></li><li><a href="/network/DDNS.html" class="sidebar-link">DDNS</a></li><li><a href="/network/home.html" aria-current="page" class="active sidebar-link">家庭网络中客厅到弱电箱只有一根网线怎么办?单臂路由?还是...</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/home.html#需求" class="sidebar-link">需求</a></li><li class="sidebar-sub-header"><a href="/network/home.html#todo拓扑图" class="sidebar-link">TODO拓扑图</a></li><li class="sidebar-sub-header"><a href="/network/home.html#光猫配置" class="sidebar-link">光猫配置</a></li><li class="sidebar-sub-header"><a href="/network/home.html#openwrt配置" class="sidebar-link">Openwrt配置</a></li><li class="sidebar-sub-header"><a href="/network/home.html#nginx配置转发相关web" class="sidebar-link">Nginx配置转发相关web</a></li><li class="sidebar-sub-header"><a href="/network/home.html#todo-补充架构图" class="sidebar-link">TODO 补充架构图</a></li><li class="sidebar-sub-header"><a href="/network/home.html#dnsmasq" class="sidebar-link">dnsmasq</a></li><li class="sidebar-sub-header"><a href="/network/home.html#host" class="sidebar-link">host</a></li></ul></li><li><a href="/network/http.html" class="sidebar-link">图解 HTTP 笔记</a></li><li><a href="/network/https.html" class="sidebar-link">Https 权威指南</a></li><li><a href="/network/iptv.html" class="sidebar-link">IPTV</a></li><li><a href="/network/modem.html" class="sidebar-link">光猫</a></li><li><a href="/network/openwrt.html" class="sidebar-link">openwrt</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="家庭网络中客厅到弱电箱只有一根网线怎么办-单臂路由-还是"><a href="#家庭网络中客厅到弱电箱只有一根网线怎么办-单臂路由-还是" class="header-anchor">#</a> 家庭网络中客厅到弱电箱只有一根网线怎么办?单臂路由?还是...</h1> <h1 id="笔者家里的网络情况"><a href="#笔者家里的网络情况" class="header-anchor">#</a> 笔者家里的网络情况</h1> <p>主要有 四口千兆光猫; K2p路由器; 无屏老笔记本 ; 若干笔记本,台式机上网设备;</p> <p>无屏老笔记本安装黑群晖和Openwrt路由系统</p> <h2 id="需求"><a href="#需求" class="header-anchor">#</a> 需求</h2> <ul><li>家庭中只有一个子网</li> <li>设备不固定IP, 使用dhcp协议, 能够通过域名访问设备</li> <li>所有设备支持IPv6</li></ul> <h1 id="方式一使用openwrt单臂路由"><a href="#方式一使用openwrt单臂路由" class="header-anchor">#</a> 方式一使用Openwrt单臂路由</h1> <h2 id="todo拓扑图"><a href="#todo拓扑图" class="header-anchor">#</a> TODO拓扑图</h2> <h2 id="光猫配置"><a href="#光猫配置" class="header-anchor">#</a> 光猫配置</h2> <ol><li>改成桥接, Internet业务取消所有的端口绑定, (按需设置Lan1端口的Vlan绑定)</li> <li>关闭DHCP服务</li></ol> <h2 id="openwrt配置"><a href="#openwrt配置" class="header-anchor">#</a> Openwrt配置</h2> <p>需要Wan口拨号上网, Lan口连接子网设备, <strong>同时绑定你的物理网卡(一般eth0)</strong></p> <p>开启DHCP; DNS服务器</p> <p>OP接口配置如下</p> <div class="language- extra-class"><pre class="language-text"><code>config interface 'loopback'
        option device 'lo'
        option proto 'static'
        option ipaddr '127.0.0.1'
        option netmask '255.0.0.0'

config globals 'globals'
        option ula_prefix 'fdf6:076a:018b::/48'
        option packet_steering '1'

config device
        option name 'br-lan'
        option type 'bridge'
        list ports 'eth0'
        option promisc '1'

config interface 'lan'
        option device 'eth0'
        option proto 'static'
        option ipaddr '192.168.2.1'
        option netmask '255.255.255.0'
        option ip6assign '60'

config interface 'wan'
        option proto 'pppoe'
        option username 'xxx'
        option password 'xxx'
        option device 'eth0'
        option ipv6 'auto'
</code></pre></div><blockquote><p>https://www.right.com.cn/forum/thread-5768047-1-1.html</p> <p>https://www.right.com.cn/FORUM/thread-6196997-1-1.html</p> <p>https://www.right.com.cn/forum/thread-4066357-1-1.html</p></blockquote> <h2 id="nginx配置转发相关web"><a href="#nginx配置转发相关web" class="header-anchor">#</a> Nginx配置转发相关web</h2> <div class="language- extra-class"><pre class="language-text"><code>proxy_connect_timeout 300s;
proxy_read_timeout 300s;
proxy_send_timeout 300s;
proxy_redirect off;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection &quot;upgrade&quot;;
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-Host $server_name;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
proxy_set_header X-Forwarded-Ssl on;

ssl_certificate &quot;/etc/acme/heroking.top/fullchain.cer&quot;;
ssl_certificate_key &quot;/etc/acme/heroking.top/heroking.top.key&quot;;
ssl_session_timeout  10m;

# http请求转换成https
error_page 497 https://$host:$server_port$request_uri;

server {
  listen 8000 default_server ssl; #bind prot 绑定的端口
  listen [::]:8000 default_server ssl;
  server_name _;
  #root /web; #directory 网站路径

  gzip on;
  gzip_types text/plain application/json application/javascript application/x-javascript text/css application/xml text/javascript;
  gzip_proxied  any;
  gzip_vary on;
  gzip_comp_level 6;
  gzip_buffers 16 8k;
  gzip_http_version 1.0;

  location ^~ /ray {
    proxy_pass http://127.0.0.1:10000;#假设WebSocket监听在环回地址的10000端口上
  }
  location / {
    root /web/ruoyi-ui;
    try_files $uri $uri/ /index.html;
    index  index.html index.htm;
  }

  location /prod-api/ {
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header REMOTE-HOST $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass http://192.168.1.150:8080/;
  }
}

server {
  listen 8000;
  listen [::]:8000;
  server_name pve.heroking.top;
  location / {
    #这里设置pve地址
    proxy_pass https://192.168.2.2:8006;
  }
}

server {
  listen 8000;
  listen [::]:8000;
  server_name k2p.heroking.top;
  auth_basic   &quot;Administrator’s Area&quot;;
  auth_basic_user_file /etc/nginx/htpasswd.conf;
  location / {
    #这里设置pve地址
    proxy_pass http://192.168.2.10;
  }
}


server {
  listen 8000;
  listen [::]:8000;
  server_name op.heroking.top;
  location / {
    proxy_pass https://192.168.2.1;
  }
  location ^~ /netdata/ {
     proxy_pass http://127.0.0.1:19999/;
  }
  location ^~ /ray {
    proxy_pass http://127.0.0.1:10000;#假设WebSocket监听在环回地址的10000端口上
  }
  location ^~ /tv {
    return 302 https://饭太硬.com/tv;
#    rewrite ^/(.*) https://饭太硬.top/tv redirect;
  }
  location /public/ {
    root /web;
  }
  location /auth/ {
    root /web;
    if ($query_string !~* &quot;auth=xxx&quot;) {  
      return 403;
    }
  }
}
</code></pre></div><h1 id="方式二使用k2p当核心路由op旁路由"><a href="#方式二使用k2p当核心路由op旁路由" class="header-anchor">#</a> 方式二使用K2p当核心路由Op旁路由</h1> <p>k2p使用dnsmasq软件提供简单的dns服务, 主要配置如下;</p> <p>这种方式下位于书房的电脑book与核心路由下的设备不属于同一个子网了,相互通信的话需要设置电脑book的静态路由<code>route -n add -net 192.168.2.0/24 192.168.1.2(k2p WanIp)</code></p> <h2 id="todo-补充架构图"><a href="#todo-补充架构图" class="header-anchor">#</a> TODO 补充架构图</h2> <h2 id="dnsmasq"><a href="#dnsmasq" class="header-anchor">#</a> dnsmasq</h2> <div class="language-text extra-class"><pre class="language-text"><code>address=/blog.heroking.top/185.199.108.153
address=/pan.heroking.top/185.199.108.153
address=/nav.heroking.top/185.199.108.153
cname=blog.heroking.top,hero-king.github.io
cname=pan.heroking.top,hero-king.github.io
cname=nav.heroking.top,hero-king.github.io
address=/op.heroking.top/192.168.2.1
address=/.heroking.top/192.168.2.4
</code></pre></div><p>子网下的设备通过DNS服务可以通过域名访问到相关设备,  <strong>书房的电脑就比较尴尬, 尝试手动指定DNS为k2p WanIp, 但是不生效,网络timeout</strong></p> <h2 id="host"><a href="#host" class="header-anchor">#</a> host</h2> <div class="language-text extra-class"><pre class="language-text"><code>127.0.0.1 broadcom.broadcom broadcom
192.168.2.10 p.to
192.168.2.10 phicomm.me
192.168.2.4 nas.heroking.top
</code></pre></div><h1 id="方式三光猫主路由openwrt旁路由"><a href="#方式三光猫主路由openwrt旁路由" class="header-anchor">#</a> 方式三光猫主路由Openwrt旁路由</h1></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/network/DDNS.html" class="prev">
        DDNS
      </a></span> <span class="next"><a href="/network/http.html">
        图解 HTTP 笔记
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f6a8c955.js" defer></script><script src="/assets/js/2.163e2f28.js" defer></script><script src="/assets/js/1.f9594dd0.js" defer></script><script src="/assets/js/70.69f21f98.js" defer></script>
  </body>
</html>
